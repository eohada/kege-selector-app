<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ¬∑ –ß—ë—Ä–Ω—ã–π –Ω–µ–æ–Ω</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='loading.css') }}">
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
</head>
<body class="{% if active_lesson %}lesson-active{% endif %}">
    {% include '_active_lesson_banner.html' %}
    
    <div class="app-shell">
        <header class="nav-primary">
            <div class="nav-brand">
                {% if current_user and current_user.is_authenticated %}
                <a href="{{ url_for('auth.user_profile') }}" class="user-profile-avatar {% if current_user.is_creator() %}creator{% endif %}" title="{{ current_user.username }} ({{ current_user.get_role_display() }})">
                    {{ current_user.username[0].upper() }}
                </a>
                {% endif %}
                <a href="{{ url_for('main.index') }}" style="text-decoration: none; display: flex; align-items: center; gap: 1rem; color: inherit;">
                    <div class="brand-mark">LOGO</div>
                    <div class="brand-caption">–°–ª–æ—Ç –ø–æ–¥ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∑–Ω–∞–∫</div>
                </a>
            </div>
            {% include '_mobile_menu.html' %}
            <nav class="nav-links">
                <a href="{{ url_for('main.dashboard') }}" class="nav-link">üë• –£—á–µ–Ω–∏–∫–∏</a>
                <a href="{{ url_for('schedule.schedule') }}" class="nav-link">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
                <a href="{{ url_for('kege_generator.kege_generator') }}" class="nav-link">üíª –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</a>
                <a href="{{ url_for('main.update_plans') }}" class="nav-link">üìù –ü–ª–∞–Ω—ã</a>
                <a href="{{ url_for('templates.templates_list') }}" class="nav-link">üìö –®–∞–±–ª–æ–Ω—ã</a>
            </nav>
        </header>

        {% include '_ux_enhancements.html' %}

        <section class="glass-panel" style="margin-bottom: 2rem;">
            <div>
                <p class="hero-eyebrow">–∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</p>
                <h1 class="hero-title">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h1>
            </div>
        </section>

        {# Flash messages –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã —á–µ—Ä–µ–∑ toast #}

        <section class="glass-panel" style="margin-bottom: 2rem; border-left: 4px solid var(--danger);">
            <div style="background: rgba(255, 108, 145, 0.12); border-left: 3px solid var(--danger); border-radius: var(--radius-sm); padding: 1rem; color: var(--danger);">
                <strong style="display: block; margin-bottom: 0.5rem;">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong>
                <p style="margin: 0; color: var(--text-primary);">–ò–º–ø–æ—Ä—Ç –¥–æ–±–∞–≤–∏—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—á–µ–Ω–∏–∫–∏ —Å —Ç–∞–∫–∏–º–∏ –∂–µ –∏–º–µ–Ω–µ–º –∏ ID –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã.</p>
            </div>
        </section>

        <section class="glass-panel">
            <form method="POST" enctype="multipart/form-data" data-validate>
                <div class="neo-field" style="margin-bottom: 1.5rem;">
                    <label class="neo-label" for="file">–í—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞</label>
                    <input type="file" 
                           id="file" 
                           name="file" 
                           accept=".json" 
                           required 
                           class="neo-input"
                           style="padding: 1rem; cursor: pointer;">
                    <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.5em;">–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–∑ —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã</small>
                </div>
                
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button type="submit" class="neo-button accent">üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <a href="{{ url_for('main.dashboard') }}" class="neo-button ghost">‚ùå –û—Ç–º–µ–Ω–∞</a>
                </div>
            </form>
        </section>
    </div>
    
    <script src="{{ url_for('static', filename='toast.js') }}"></script>
    <script src="{{ url_for('static', filename='loading.js') }}"></script>
    <script src="{{ url_for('static', filename='audit-tracker.js') }}"></script>
    <script>
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º flash-—Å–æ–æ–±—â–µ–Ω–∏—è –≤ toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        {% if category == 'error' or category == 'danger' %}
                            if (typeof toast !== 'undefined' && toast) {
                                toast.error('{{ message|e }}');
                            } else if (window.toast) {
                                window.toast.error('{{ message|e }}');
                            }
                        {% elif category == 'warning' %}
                            if (typeof toast !== 'undefined' && toast) {
                                toast.warning('{{ message|e }}');
                            } else if (window.toast) {
                                window.toast.warning('{{ message|e }}');
                            }
                        {% elif category == 'info' %}
                            if (typeof toast !== 'undefined' && toast) {
                                toast.info('{{ message|e }}');
                            } else if (window.toast) {
                                window.toast.info('{{ message|e }}');
                            }
                        {% else %}
                            if (typeof toast !== 'undefined' && toast) {
                                toast.success('{{ message|e }}');
                            } else if (window.toast) {
                                window.toast.success('{{ message|e }}');
                            }
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endwith %}
        });
    </script>
</body>
</html>
