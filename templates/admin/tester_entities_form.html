<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if tester %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞{% else %}–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞{% endif %} ¬∑ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
    <style>
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        .form-label .required {
            color: #ef4444;
        }
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--surface-2);
            border: 1px solid var(--stroke-1);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.95rem;
        }
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-1);
            box-shadow: 0 0 0 3px rgba(var(--accent-1-rgb), 0.1);
        }
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-help {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .form-checkbox input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <header class="nav-primary">
            <div class="nav-brand">
                {% if current_user and current_user.is_authenticated %}
                <a href="{{ url_for('auth.user_profile') }}" class="user-profile-avatar {% if current_user.is_creator() %}creator{% endif %}" title="{{ current_user.username }} ({{ current_user.get_role_display() }})">
                    {{ current_user.username[0].upper() }}
                </a>
                {% endif %}
                <a href="{{ url_for('main.index') }}" style="text-decoration: none; display: flex; align-items: center; gap: 1rem; color: inherit;">
                    <div class="brand-mark">LOGO</div>
                    <div class="brand-caption">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                </a>
            </div>
            <nav class="nav-links">
                <a href="{{ url_for('main.dashboard') }}" class="nav-link">üë• –£—á–µ–Ω–∏–∫–∏</a>
                <a href="{{ url_for('schedule.schedule') }}" class="nav-link">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
                <a href="{{ url_for('kege_generator.kege_generator') }}" class="nav-link">üíª –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</a>
                <a href="{{ url_for('admin.admin_audit') }}" class="nav-link">üìä –õ–æ–≥–∏</a>
                <a href="{{ url_for('admin.admin_tester_entities') }}" class="nav-link active">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∏</a>
                <a href="{{ url_for('templates.templates_list') }}" class="nav-link"><img src="{{ url_for('static', filename='icons/SHABL.png') }}" alt="–®–∞–±–ª–æ–Ω—ã" class="ui-icon ui-icon--sm">–®–∞–±–ª–æ–Ω—ã</a>
            </nav>
        </header>

        {% include '_ux_enhancements.html' %}

        <section class="glass-panel" style="margin: 2rem auto; max-width: 1400px;">
            <div style="margin-bottom: 1.5rem;">
                <a href="{{ url_for('admin.admin_tester_entities') }}" class="neo-button ghost" style="text-decoration: none;">
                    ‚Üê –ö —Å–ø–∏—Å–∫—É —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤
                </a>
            </div>
            <h1 style="margin-bottom: 1rem;">
                {% if tester %}
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞
                {% else %}
                    –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞
                {% endif %}
            </h1>

            <div class="form-container">
                <form method="POST" action="{% if tester %}{{ url_for('admin.admin_tester_entities_edit', tester_id=tester.tester_id) }}{% else %}{{ url_for('admin.admin_tester_entities_create') }}{% endif %}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="form-group">
                        <label for="name" class="form-label">
                            –ò–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞ <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            class="form-input" 
                            value="{{ tester.name if tester else '' }}" 
                            required
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞">
                        <div class="form-help">
                            –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="ip_address" class="form-label">
                            IP –∞–¥—Ä–µ—Å
                        </label>
                        <input 
                            type="text" 
                            id="ip_address" 
                            name="ip_address" 
                            class="form-input" 
                            value="{{ tester.ip_address if tester else '' }}" 
                            placeholder="192.168.1.1">
                        <div class="form-help">
                            IP –∞–¥—Ä–µ—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="user_agent" class="form-label">
                            User Agent
                        </label>
                        <textarea 
                            id="user_agent" 
                            name="user_agent" 
                            class="form-textarea" 
                            placeholder="Mozilla/5.0...">{{ tester.user_agent if tester else '' }}</textarea>
                        <div class="form-help">
                            User Agent –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="session_id" class="form-label">
                            Session ID
                        </label>
                        <input 
                            type="text" 
                            id="session_id" 
                            name="session_id" 
                            class="form-input" 
                            value="{{ tester.session_id if tester else '' }}" 
                            placeholder="session_id">
                        <div class="form-help">
                            ID —Å–µ—Å—Å–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-checkbox">
                            <input 
                                type="checkbox" 
                                id="is_active" 
                                name="is_active" 
                                {% if tester and tester.is_active or not tester %}checked{% endif %}>
                            <label for="is_active" class="form-label" style="margin: 0; cursor: pointer;">
                                –ê–∫—Ç–∏–≤–µ–Ω
                            </label>
                        </div>
                        <div class="form-help">
                            –ï—Å–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
                        </div>
                    </div>

                    {% if tester %}
                    <div class="form-group" style="padding: 1rem; background: var(--surface-2); border-radius: var(--radius-sm); border: 1px solid var(--stroke-1);">
                        <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–µ:</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                            <div><strong>ID:</strong> {{ tester.tester_id }}</div>
                            <div><strong>–ü–µ—Ä–≤–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ:</strong> {{ tester.first_seen.strftime('%d.%m.%Y %H:%M:%S') if tester.first_seen else '‚Äî' }}</div>
                            <div><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> {{ tester.last_seen.strftime('%d.%m.%Y %H:%M:%S') if tester.last_seen else '‚Äî' }}</div>
                        </div>
                    </div>
                    {% endif %}

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="neo-button accent" style="flex: 1;">
                            {% if tester %}
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            {% else %}
                                <img src="{{ url_for('static', filename='icons/SULP.png') }}" alt="–°–æ–∑–¥–∞—Ç—å" class="ui-icon ui-icon--sm">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞
                            {% endif %}
                        </button>
                        <a href="{{ url_for('admin.admin_tester_entities') }}" class="neo-button outline" style="text-decoration: none; flex: 1; text-align: center;">
                            –û—Ç–º–µ–Ω–∞
                        </a>
                    </div>
                </form>
            </div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='toast.js') }}"></script>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <script>
                    showToast('{{ message }}', '{{ category }}');
                </script>
            {% endfor %}
        {% endif %}
    {% endwith %}
</body>
</html>

