<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ ¬∑ –ß—ë—Ä–Ω—ã–π –Ω–µ–æ–Ω</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
    {% include '_ux_enhancements.html' %}
</head>
<body>
    <header class="nav-primary">
        <div class="nav-brand">
            {% if current_user and current_user.is_authenticated %}
            <a href="{{ url_for('auth.user_profile') }}" class="user-profile-avatar {% if current_user.is_creator() %}creator{% endif %}" title="{{ current_user.username }} ({{ current_user.get_role_display() }})">
                {{ current_user.username[0].upper() }}
            </a>
            {% endif %}
            <a href="{{ url_for('main.index') }}" style="text-decoration: none; display: flex; align-items: center; gap: 1rem; color: inherit;">
                <div class="brand-mark">LOGO</div>
                <div class="brand-caption">–°–ª–æ—Ç –ø–æ–¥ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∑–Ω–∞–∫</div>
            </a>
        </div>
        {% include '_mobile_menu.html' %}
        <nav class="nav-links">
            <a href="{{ url_for('main.dashboard') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/students_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –£—á–µ–Ω–∏–∫–∏" class="nav-link-icon">
                    <span class="nav-link-label">–£—á–µ–Ω–∏–∫–∏</span>
                </span>
            </a>
            <a href="{{ url_for('schedule.schedule') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/schedule_white.png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" class="nav-link-icon">
                    <span class="nav-link-label">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
                </span>
            </a>
            <a href="{{ url_for('kege_generator.kege_generator') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/generator_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä" class="nav-link-icon">
                    <span class="nav-link-label">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</span>
                </span>
            </a>
            <a href="{{ url_for('main.update_plans') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/notes_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –ü–ª–∞–Ω—ã" class="nav-link-icon">
                    <span class="nav-link-label">–ü–ª–∞–Ω—ã</span>
                </span>
            </a>
            <a href="{{ url_for('templates.templates_list') }}" class="nav-link active">
                <span class="nav-link-content">
                    <span class="nav-link-icon">üìö</span>
                    <span class="nav-link-label">–®–∞–±–ª–æ–Ω—ã</span>
                </span>
            </a>
        </nav>
    </header>

    <div class="app-shell">
        <section class="glass-panel" style="margin-bottom: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div>
                    <p class="hero-eyebrow">–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤</p>
                    <h1 class="hero-title">üìö –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞–Ω–∏–π</h1>
                    <p class="hero-subtitle">–ì–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –î–ó, –∫–ª–∞—Å—Å–Ω—ã—Ö –∏ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö —Ä–∞–±–æ—Ç</p>
                </div>
                <a href="{{ url_for('templates.template_new') }}" class="neo-button accent">‚ûï –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</a>
            </div>
        </section>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <section class="glass-panel" style="margin-bottom: 2rem;">
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-muted);">–¢–∏–ø —à–∞–±–ª–æ–Ω–∞:</label>
                    <select id="typeFilter" onchange="applyFilters()" style="padding: 0.5rem 1rem; border: 1px solid var(--stroke-1); border-radius: var(--radius-sm); background: var(--surface-1); color: var(--text-primary);">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="homework" {% if current_type == 'homework' %}selected{% endif %}>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</option>
                        <option value="classwork" {% if current_type == 'classwork' %}selected{% endif %}>–ö–ª–∞—Å—Å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                        <option value="exam" {% if current_type == 'exam' %}selected{% endif %}>–ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                        <option value="lesson" {% if current_type == 'lesson' %}selected{% endif %}>–£—Ä–æ–∫–∏</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-muted);">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="categoryFilter" onchange="applyFilters()" style="padding: 0.5rem 1rem; border: 1px solid var(--stroke-1); border-radius: var(--radius-sm); background: var(--surface-1); color: var(--text-primary);">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="–ï–ì–≠" {% if current_category == '–ï–ì–≠' %}selected{% endif %}>–ï–ì–≠</option>
                        <option value="–û–ì–≠" {% if current_category == '–û–ì–≠' %}selected{% endif %}>–û–ì–≠</option>
                        <option value="–õ–ï–í–ï–õ–ê–ü" {% if current_category == '–õ–ï–í–ï–õ–ê–ü' %}selected{% endif %}>–õ–ï–í–ï–õ–ê–ü</option>
                        <option value="–ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–ï" {% if current_category == '–ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–ï' %}selected{% endif %}>–ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–ï</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- –†–∞–∑–¥–µ–ª—ã —à–∞–±–ª–æ–Ω–æ–≤ -->
        {% for type_key, type_name, type_icon in [
            ('homework', '–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è', 'üìù'),
            ('classwork', '–ö–ª–∞—Å—Å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã', 'üè´'),
            ('exam', '–ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã', '‚úÖ'),
            ('lesson', '–£—Ä–æ–∫–∏', 'üìö')
        ] %}
        {% set type_templates = templates_by_type.get(type_key, []) %}
        {% if not current_type or current_type == type_key %}
        <section class="glass-panel" style="margin-bottom: 2rem;">
            <div class="panel-head">
                <div>
                    <p class="eyebrow">{{ type_icon }} {{ type_name }}</p>
                    <h2>{{ type_templates|length }} —à–∞–±–ª–æ–Ω–æ–≤</h2>
                </div>
            </div>

            {% if type_templates %}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                {% for template in type_templates %}
                <div class="template-card" style="background: var(--surface-2); border: 1px solid var(--stroke-1); border-radius: var(--radius-lg); padding: 1.5rem; transition: all 0.3s ease; overflow: hidden;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.2em; font-weight: 700;">{{ template.name }}</h3>
                            {% if template.description %}
                            <p style="margin: 0; color: var(--text-muted); font-size: 0.9em;">{{ template.description[:100] }}{% if template.description|length > 100 %}...{% endif %}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                        {% if template.category %}
                        <span style="padding: 0.25rem 0.75rem; background: var(--accent-1); color: white; border-radius: var(--radius-sm); font-size: 0.85em; font-weight: 600;">{{ template.category }}</span>
                        {% endif %}
                        <span style="padding: 0.25rem 0.75rem; background: var(--surface-3); color: var(--text-muted); border-radius: var(--radius-sm); font-size: 0.85em;">
                            {{ template.template_tasks|length }} –∑–∞–¥–∞–Ω–∏–π
                        </span>
                    </div>

                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; width: 100%;">
                        <a href="{{ url_for('templates.template_view', template_id=template.template_id) }}" class="neo-button ghost" style="flex: 1 1 0%; min-width: 0; text-align: center; text-decoration: none; padding: 0.85rem 0.75rem; font-size: 0.9rem;">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                        <a href="{{ url_for('templates.template_edit', template_id=template.template_id) }}" class="neo-button ghost" style="flex: 1 1 0%; min-width: 0; text-align: center; text-decoration: none; padding: 0.85rem 0.75rem; font-size: 0.9rem;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state" style="padding: 3rem; text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üì≠</div>
                <h3>–ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤</h3>
                <p style="color: var(--text-muted);">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞</p>
            </div>
            {% endif %}
        </section>
        {% endif %}
        {% endfor %}
    </div>

    <script src="{{ url_for('static', filename='toast.js') }}"></script>
    <script src="{{ url_for('static', filename='flash-to-toast.js') }}"></script>
    <script>
        function applyFilters() {
            const type = document.getElementById('typeFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const params = new URLSearchParams();
            if (type) params.append('type', type);
            if (category) params.append('category', category);
            window.location.href = '{{ url_for('templates.templates_list') }}?' + params.toString();
        }
    </script>
</body>
</html>










