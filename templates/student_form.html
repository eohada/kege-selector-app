<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} ¬∑ –ß—ë—Ä–Ω—ã–π –Ω–µ–æ–Ω</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='loading.css') }}">
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
    <style>
        .form-hero {
            margin-bottom: 2rem;
        }
        
        .form-section {
            background: var(--surface-1);
            border: 1px solid var(--stroke-1);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-section-title {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--stroke-1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .form-grid-full {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body class="{% if active_lesson %}lesson-active{% endif %}">
    {% if active_lesson %}
    <div class="now-playing-pill" onclick="toggleLessonMenu()">
        üéß –£—Ä–æ–∫ –∏–¥–µ—Ç: {{ active_student.name }}
    </div>
    <div class="now-playing-panel" id="lessonMenu">
        <div class="hero-eyebrow">—Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫</div>
        <p style="margin: 0 0 0.4rem 0;"><strong>–£—á–µ–Ω–∏–∫:</strong> {{ active_student.name }}</p>
        {% if active_lesson.topic %}
        <p style="margin: 0 0 0.4rem 0;"><strong>–¢–µ–º–∞:</strong> {{ active_lesson.topic }}</p>
        {% endif %}
        <p style="margin: 0 0 0.4rem 0;"><strong>–î–∞—Ç–∞:</strong> {{ active_lesson.lesson_date.strftime('%d.%m.%Y %H:%M') }}</p>
        <p style="margin: 0;"><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ active_lesson.duration }} –º–∏–Ω—É—Ç</p>
        <div class="hero-actions" style="margin-top: 1rem;">
            <form method="POST" action="{{ url_for('lesson_complete', lesson_id=active_lesson.lesson_id) }}">
                <button type="submit" class="neo-button accent">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
            </form>
            <a href="{{ url_for('student_profile', student_id=active_student.student_id) }}" class="neo-button ghost">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        </div>
    </div>
    <script>
        function toggleLessonMenu() {
            const menu = document.getElementById('lessonMenu');
            if (menu) {
                menu.classList.toggle('active');
            }
        }
        document.addEventListener('click', (event) => {
            const menu = document.getElementById('lessonMenu');
            const badge = document.querySelector('.now-playing-pill');
            if (!menu || !badge) return;
            if (!menu.contains(event.target) && !badge.contains(event.target)) {
                menu.classList.remove('active');
            }
        });
    </script>
    {% endif %}

    <div class="app-shell">
        <header class="nav-primary">
            <div class="nav-brand">
                <div class="brand-mark">LOGO</div>
                <div class="brand-caption">–°–ª–æ—Ç –ø–æ–¥ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∑–Ω–∞–∫</div>
            </div>
            <nav class="nav-links"> <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º -->
                <a href="{{ url_for('dashboard') }}" class="nav-link"> <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ —É—á–µ–Ω–∏–∫–æ–≤ -->
                    <span class="nav-link-content"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∫–æ–Ω–∫–∏ –∏ –ø–æ–¥–ø–∏—Å–∏ -->
                        <img src="{{ url_for('static', filename='icons/students_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –£—á–µ–Ω–∏–∫–∏" class="nav-link-icon"> <!-- –ò–∫–æ–Ω–∫–∞ —É—á–∞—â–∏—Ö—Å—è -->
                        <span class="nav-link-label">–£—á–µ–Ω–∏–∫–∏</span> <!-- –ü–æ–¥–ø–∏—Å—å —Ä–∞–∑–¥–µ–ª–∞ -->
                    </span>
                </a>
                <a href="{{ url_for('schedule') }}" class="nav-link"> <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
                    <span class="nav-link-content"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
                        <img src="{{ url_for('static', filename='icons/schedule_white.png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" class="nav-link-icon"> <!-- –ò–∫–æ–Ω–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
                        <span class="nav-link-label">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span> <!-- –ü–æ–¥–ø–∏—Å—å —Ä–∞–∑–¥–µ–ª–∞ -->
                    </span>
                </a>
                <a href="{{ url_for('kege_generator') }}" class="nav-link"> <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä -->
                    <span class="nav-link-content"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ -->
                        <img src="{{ url_for('static', filename='icons/generator_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä" class="nav-link-icon"> <!-- –ò–∫–æ–Ω–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ -->
                        <span class="nav-link-label">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</span> <!-- –ü–æ–¥–ø–∏—Å—å —Ä–∞–∑–¥–µ–ª–∞ -->
                    </span>
                </a>
                <a href="{{ url_for('update_plans') }}" class="nav-link"> <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞–Ω—ã -->
                    <span class="nav-link-content"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–∞–Ω–æ–≤ -->
                        <img src="{{ url_for('static', filename='icons/notes_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –ü–ª–∞–Ω—ã" class="nav-link-icon"> <!-- –ò–∫–æ–Ω–∫–∞ –ø–ª–∞–Ω–æ–≤ -->
                        <span class="nav-link-label">–ü–ª–∞–Ω—ã</span> <!-- –ü–æ–¥–ø–∏—Å—å —Ä–∞–∑–¥–µ–ª–∞ -->
                    </span>
                </a>
            </nav>
            <div class="nav-actions">
                <div class="brand-caption icon-slot"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∫–æ–Ω–∫–∏ —Ä–∞–∑–¥–µ–ª–∞ –£—á–µ–Ω–∏–∫–∏ -->
                    <img src="{{ url_for('static', filename='icons/students_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –£—á–µ–Ω–∏–∫–∏" class="brand-icon brand-icon--students"> <!-- –ë–µ–ª–∞—è –∏–∫–æ–Ω–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ -->
                </div>
            </div>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <section class="glass-panel form-hero">
            <div>
                <p class="hero-eyebrow">—Ñ–æ—Ä–º–∞ —É—á–µ–Ω–∏–∫–∞</p>
                <h1 class="hero-title">{{ title }}</h1>
            </div>
        </section>

        <form method="POST">
            {{ form.hidden_tag() }}
            
            <section class="form-section">
                <div class="form-section-title">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                <div class="form-grid">
                    <div class="neo-field">
                        {{ form.name.label(class='neo-label') }}
                        {{ form.name(class='neo-input', placeholder='–ü–µ—Ç—è') }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–ü–æ–ª–Ω–æ–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞</small>
                    </div>
                    
                    <div class="neo-field">
                        {{ form.platform_id.label(class='neo-label') }}
                        {{ form.platform_id(class='neo-input', placeholder='–ú–æ—Ä–∫–æ–≤–Ω–∞—è —á–∞–π–∫–∞ 53...') }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</small>
                    </div>
                    
                    <div class="neo-field">
                        {{ form.category.label(class='neo-label') }}
                        {{ form.category(class='neo-select') }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—á–µ–Ω–∏–∫–∞ –¥–ª—è —É–¥–æ–±–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</small>
                    </div>
                </div>
            </section>
            
            <section class="form-section">
                <div class="form-section-title">üéØ –¶–µ–ª–∏ –∏ —Å—Ä–æ–∫–∏</div>
                <div class="form-grid">
                    <div class="neo-field">
                        {{ form.target_score.label(class='neo-label') }}
                        {{ form.target_score(class='neo-input', placeholder='85') }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–¶–µ–ª–µ–≤–æ–π –±–∞–ª–ª –ï–ì–≠ (0-100)</small>
                    </div>
                    
                    <div class="neo-field">
                        {{ form.deadline.label(class='neo-label') }}
                        {{ form.deadline(class='neo-input', placeholder='–ò—é–Ω—å 2025') }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–ö –∫–∞–∫–æ–º—É —Å—Ä–æ–∫—É –Ω—É–∂–Ω–æ –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏</small>
                    </div>
                </div>
            </section>
            
            <section class="form-section">
                <div class="form-section-title">üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ü–µ–Ω–∫–∞</div>
                <div class="form-grid">
                    <div class="neo-field">
                        {{ form.diagnostic_level.label(class='neo-label') }}
                        {{ form.diagnostic_level(class='neo-input', placeholder='60-70 –±–∞–ª–ª–æ–≤') }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–£—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</small>
                    </div>
                    
                    <div class="neo-field">
                        {{ form.overall_rating.label(class='neo-label') }}
                        {{ form.overall_rating(class='neo-input', placeholder='7/10' or '–•–æ—Ä–æ—à–æ') }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —É—á–µ–Ω–∏–∫–∞ (—Ü–∏—Ñ—Ä–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç)</small>
                    </div>
                    
                    <div class="neo-field form-grid-full">
                        {{ form.preferences.label(class='neo-label') }}
                        {{ form.preferences(class='neo-input', placeholder='–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç —Ç–µ–æ—Ä–∏—é —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏, –ª—é–±–∏—Ç –ø—Ä–∞–∫—Ç–∏–∫—É...', rows=3) }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–ö–∞–∫ —É—á–µ–Ω–∏–∫ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏</small>
                    </div>
                    
                    <div class="neo-field form-grid-full">
                        {{ form.strengths.label(class='neo-label') }}
                        {{ form.strengths(class='neo-input', placeholder='–û—Ç–ª–∏—á–Ω–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö...', rows=3) }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–ù–∞–∏–±–æ–ª–µ–µ —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ —É—á–µ–Ω–∏–∫–∞</small>
                    </div>
                    
                    <div class="neo-field form-grid-full">
                        {{ form.weaknesses.label(class='neo-label') }}
                        {{ form.weaknesses(class='neo-input', placeholder='–ü—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∏–∫–æ–π, –Ω—É–∂–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞...', rows=3) }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–ù–∞–∏–±–æ–ª–µ–µ —Å–ª–∞–±–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ —É—á–µ–Ω–∏–∫–∞</small>
                    </div>
                </div>
            </section>
            
            <section class="form-section">
                <div class="form-section-title">üìù –û–ø–∏—Å–∞–Ω–∏–µ</div>
                <div class="form-grid">
                    <div class="neo-field form-grid-full">
                        {{ form.description.label(class='neo-label') }}
                        {{ form.description(class='neo-input', placeholder='–ú–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—á–µ–Ω–∏–∫, —Ö–æ—Ä–æ—à–æ —É—Å–≤–∞–∏–≤–∞–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª...', rows=4) }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–ö—Ä–∞—Ç–∫–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞</small>
                    </div>
                    
                    <div class="neo-field form-grid-full">
                        {{ form.notes.label(class='neo-label') }}
                        {{ form.notes(class='neo-input', placeholder='–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏...', rows=5) }}
                        <small style="display: block; color: var(--text-muted); font-size: 0.85em; margin-top: 0.3em;">–õ—é–±—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</small>
                    </div>
                </div>
            </section>
            
            <section class="form-section">
                <div class="form-actions" style="display: flex; gap: 1em; justify-content: flex-end; margin-top: 0;">
                    {{ form.submit(class='neo-button accent') }}
                    <a href="{{ url_for('dashboard') }}" class="neo-button ghost">–û—Ç–º–µ–Ω–∞</a>
                </div>
            </section>
        </form>
    </div>
    
    <script src="{{ url_for('static', filename='csrf-helper.js') }}"></script>
    <script src="{{ url_for('static', filename='audit-tracker.js') }}"></script>
</body>
</html>
