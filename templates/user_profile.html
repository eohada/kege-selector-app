<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å ¬∑ –ß—ë—Ä–Ω—ã–π –Ω–µ–æ–Ω</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
</head>
<body>
    <div class="app-shell">
        <header class="nav-primary">
            <div class="nav-brand">
                {% if current_user and current_user.is_authenticated %}
                <a href="{{ url_for('auth.user_profile') }}" class="user-profile-avatar {% if current_user.is_creator() %}creator{% endif %}" title="{{ current_user.username }} ({{ current_user.get_role_display() }})" style="border-color: var(--accent-1); box-shadow: 0 0 20px rgba(0, 255, 213, 0.4);">
                    {{ current_user.username[0].upper() }}
                </a>
                {% endif %}
                <a href="{{ url_for('main.index') }}" style="text-decoration: none; display: flex; align-items: center; gap: 1rem; color: inherit;">
                    <div class="brand-mark">LOGO</div>
                    <div class="brand-caption">–ß—ë—Ä–Ω—ã–π –Ω–µ–æ–Ω</div>
                </a>
            </div>
            {% include '_mobile_menu.html' %}
            <nav class="nav-links">
                <a href="{{ url_for('main.dashboard') }}" class="nav-link">
                    <span class="nav-link-content">
                        <img src="{{ url_for('static', filename='icons/students_white-no-bg-preview (carve.photos).png') }}" alt="–£—á–µ–Ω–∏–∫–∏" class="nav-link-icon">
                        <span class="nav-link-label">–£—á–µ–Ω–∏–∫–∏</span>
                    </span>
                </a>
                <a href="{{ url_for('schedule.schedule') }}" class="nav-link">
                    <span class="nav-link-content">
                        <img src="{{ url_for('static', filename='icons/schedule_white.png') }}" alt="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" class="nav-link-icon">
                        <span class="nav-link-label">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
                    </span>
                </a>
                <a href="{{ url_for('kege_generator.kege_generator') }}" class="nav-link">
                    <span class="nav-link-content">
                        <img src="{{ url_for('static', filename='icons/generator_white-no-bg-preview (carve.photos).png') }}" alt="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä" class="nav-link-icon">
                        <span class="nav-link-label">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</span>
                    </span>
                </a>
                <a href="{{ url_for('main.update_plans') }}" class="nav-link">
                    <span class="nav-link-content">
                        <img src="{{ url_for('static', filename='icons/notes_white-no-bg-preview (carve.photos).png') }}" alt="–ü–ª–∞–Ω—ã" class="nav-link-icon">
                        <span class="nav-link-label">–ü–ª–∞–Ω—ã</span>
                    </span>
                </a>
            </nav>
        </header>

        <section class="glass-panel" style="margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <a href="{{ url_for('main.dashboard') }}" class="neo-button ghost" style="text-decoration: none;">
                    ‚Üê –ù–∞–∑–∞–¥
                </a>
            </div>
            <p class="hero-eyebrow">–ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
            <h1 class="hero-title">–ü—Ä–æ—Ñ–∏–ª—å: {% if current_user %}{{ current_user.username }}{% else %}–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å{% endif %}</h1>
        </section>

        {% if current_user %}
        <section class="glass-panel">
            <div style="display: grid; gap: 2rem;">
                <div>
                    <h2 style="margin-bottom: 1rem; color: var(--text-primary);">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--surface-2); border-radius: var(--radius-sm);">
                            <span style="color: var(--text-muted);">–õ–æ–≥–∏–Ω:</span>
                            <strong style="color: var(--text-primary);">{{ current_user.username }}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--surface-2); border-radius: var(--radius-sm);">
                            <span style="color: var(--text-muted);">–†–æ–ª—å:</span>
                            <strong style="color: var(--accent-1);">{{ current_user.get_role_display() }}</strong>
                        </div>
                        {% if current_user.created_at %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--surface-2); border-radius: var(--radius-sm);">
                            <span style="color: var(--text-muted);">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                            <span style="color: var(--text-primary);">{{ current_user.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                        </div>
                        {% endif %}
                        {% if current_user.last_login %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--surface-2); border-radius: var(--radius-sm);">
                            <span style="color: var(--text-muted);">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</span>
                            <span style="color: var(--text-primary);">{{ current_user.last_login.strftime('%d.%m.%Y %H:%M') }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if current_user.is_creator() %}
                <div>
                    <h2 style="margin-bottom: 1rem; color: var(--text-primary);">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                        <a href="{{ url_for('admin.admin_panel') }}" class="neo-button accent" style="text-decoration: none;">
                            ‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                        </a>
                    </div>
                </div>
                {% endif %}
                
                <div>
                    <h2 style="margin-bottom: 1rem; color: var(--text-primary);">–î–µ–π—Å—Ç–≤–∏—è</h2>
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                        <form method="POST" action="{{ url_for('logout') }}" style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="neo-button outline" style="cursor: pointer; border-color: var(--danger); color: var(--danger);" onmouseover="this.style.background='rgba(255, 108, 145, 0.1)'" onmouseout="this.style.background='transparent'">
                                üö™ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        {% else %}
        <section class="glass-panel">
            <div style="padding: 2rem; text-align: center; color: var(--text-muted);">
                <p>–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.</p>
                <a href="{{ url_for('auth.login') }}" class="neo-button accent" style="margin-top: 1rem; text-decoration: none; display: inline-block;">–í–æ–π—Ç–∏</a>
            </div>
        </section>
        {% endif %}
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <script type="application/json" id="flash-messages">
    [
        {% for category, message in messages %}
        {"category": "{{ category }}", "message": {{ message|tojson }}}{% if not loop.last %},{% endif %}
        {% endfor %}
    ]
    </script>
    {% endif %}
    {% endwith %}
    
    <script src="{{ url_for('static', filename='toast.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var flashMessagesEl = document.getElementById('flash-messages');
            if (flashMessagesEl) {
                try {
                    var messages = JSON.parse(flashMessagesEl.textContent);
                    messages.forEach(function(msg) {
                        var toastFunc = window.toast || (typeof toast !== 'undefined' ? toast : null);
                        if (!toastFunc) return;
                        
                        if (msg.category === 'error' || msg.category === 'danger') {
                            toastFunc.error(msg.message);
                        } else if (msg.category === 'warning') {
                            toastFunc.warning(msg.message);
                        } else if (msg.category === 'info') {
                            toastFunc.info(msg.message);
                        } else {
                            toastFunc.success(msg.message);
                        }
                    });
                } catch (e) {
                    console.error('Error parsing flash messages:', e);
                }
            }
        });
    </script>
</body>
</html>
