<!DOCTYPE html> <!-- comment -->
<html lang="ru"> <!-- comment -->
<head> <!-- comment -->
    <meta charset="UTF-8"> <!-- comment -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- comment -->
    <title>{{ student.name }} ¬∑ –£—á–µ–±–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</title> <!-- comment -->
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}"> <!-- comment -->
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}"> <!-- comment -->
    <link rel="stylesheet" href="{{ url_for('static', filename='loading.css') }}"> <!-- comment -->
    {% include '_ux_enhancements.html' %} <!-- comment -->
    {% if csrf_token %} <!-- comment -->
    <meta name="csrf-token" content="{{ csrf_token() }}"> <!-- comment -->
    {% endif %} <!-- comment -->
    <style> /* comment */
        .page-shell { /* comment */
            padding: 2rem 1.5rem 3rem; /* comment */
        } /* comment */
        .hero { /* comment */
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.06), rgba(110, 64, 255, 0.08)); /* comment */
            border: 1px solid var(--glass-border); /* comment */
            border-radius: var(--radius-lg); /* comment */
            padding: 1.5rem; /* comment */
            margin-bottom: 2rem; /* comment */
        } /* comment */
        .hero-top { /* comment */
            display: flex; /* comment */
            flex-wrap: wrap; /* comment */
            gap: 1.5rem; /* comment */
            align-items: center; /* comment */
            justify-content: space-between; /* comment */
        } /* comment */
        .hero-left { /* comment */
            display: flex; /* comment */
            align-items: center; /* comment */
            gap: 1rem; /* comment */
        } /* comment */
        .avatar { /* comment */
            width: 64px; /* comment */
            height: 64px; /* comment */
            border-radius: 50%; /* comment */
            background: rgba(255, 255, 255, 0.08); /* comment */
            display: flex; /* comment */
            align-items: center; /* comment */
            justify-content: center; /* comment */
            font-weight: 700; /* comment */
            font-size: 1.5rem; /* comment */
            color: var(--accent); /* comment */
        } /* comment */
        .hero-meta { /* comment */
            display: flex; /* comment */
            flex-wrap: wrap; /* comment */
            gap: 0.75rem 1.5rem; /* comment */
            margin-top: 0.5rem; /* comment */
            color: var(--text-muted); /* comment */
            font-size: 0.9rem; /* comment */
        } /* comment */
        .action-row { /* comment */
            display: flex; /* comment */
            flex-wrap: wrap; /* comment */
            gap: 0.6rem; /* comment */
        } /* comment */
        .grid { /* comment */
            display: grid; /* comment */
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* comment */
            gap: 1rem; /* comment */
        } /* comment */
        .panel { /* comment */
            background: var(--glass-bg); /* comment */
            border: 1px solid var(--glass-border); /* comment */
            border-radius: var(--radius-lg); /* comment */
            padding: 1.25rem; /* comment */
        } /* comment */
        .panel h3 { /* comment */
            margin-top: 0; /* comment */
            margin-bottom: 0.75rem; /* comment */
        } /* comment */
        .workflow { /* comment */
            display: grid; /* comment */
            gap: 0.6rem; /* comment */
        } /* comment */
        .workflow-step { /* comment */
            padding: 0.6rem 0.9rem; /* comment */
            border-radius: 10px; /* comment */
            border: 1px dashed var(--glass-border); /* comment */
            color: var(--text-muted); /* comment */
        } /* comment */
        .workflow-step.active { /* comment */
            border-style: solid; /* comment */
            border-color: var(--accent); /* comment */
            color: var(--text-main); /* comment */
            background: rgba(0, 255, 210, 0.06); /* comment */
        } /* comment */
        .lesson-card { /* comment */
            background: rgba(0, 0, 0, 0.25); /* comment */
            border: 1px solid var(--glass-border); /* comment */
            border-radius: var(--radius-lg); /* comment */
            padding: 1rem; /* comment */
            display: grid; /* comment */
            gap: 0.7rem; /* comment */
        } /* comment */
        .lesson-title { /* comment */
            font-size: 1.1rem; /* comment */
            font-weight: 600; /* comment */
        } /* comment */
        .lesson-meta { /* comment */
            display: flex; /* comment */
            flex-wrap: wrap; /* comment */
            gap: 0.7rem 1.2rem; /* comment */
            color: var(--text-muted); /* comment */
            font-size: 0.85rem; /* comment */
        } /* comment */
        .lesson-actions { /* comment */
            display: flex; /* comment */
            flex-wrap: wrap; /* comment */
            gap: 0.6rem; /* comment */
        } /* comment */
        .badge { /* comment */
            display: inline-flex; /* comment */
            align-items: center; /* comment */
            gap: 0.35rem; /* comment */
            padding: 0.2rem 0.6rem; /* comment */
            border-radius: 999px; /* comment */
            font-size: 0.75rem; /* comment */
            background: rgba(255, 255, 255, 0.08); /* comment */
            color: var(--text-muted); /* comment */
        } /* comment */
        .filter-row { /* comment */
            display: flex; /* comment */
            flex-wrap: wrap; /* comment */
            gap: 0.6rem; /* comment */
            margin-bottom: 1rem; /* comment */
        } /* comment */
        .filter-row input, .filter-row select { /* comment */
            background: rgba(255, 255, 255, 0.06); /* comment */
            border: 1px solid var(--glass-border); /* comment */
            border-radius: 10px; /* comment */
            padding: 0.6rem 0.8rem; /* comment */
            color: var(--text-main); /* comment */
        } /* comment */
        .submissions-list { /* comment */
            display: grid; /* comment */
            gap: 0.6rem; /* comment */
        } /* comment */
        .submission-item { /* comment */
            padding: 0.7rem 0.9rem; /* comment */
            border-radius: 12px; /* comment */
            border: 1px solid var(--glass-border); /* comment */
            background: rgba(0, 0, 0, 0.2); /* comment */
            display: flex; /* comment */
            align-items: center; /* comment */
            justify-content: space-between; /* comment */
            gap: 1rem; /* comment */
        } /* comment */
        .muted { /* comment */
            color: var(--text-muted); /* comment */
            font-size: 0.85rem; /* comment */
        } /* comment */
    </style> <!-- comment -->
</head> <!-- comment -->
<body data-csrf-token="{{ csrf_token() if csrf_token else '' }}"> <!-- comment -->
    {% include '_primary_nav.html' %} <!-- comment -->
    {% include '_mobile_menu.html' %} <!-- comment -->
    <main class="page-shell"> <!-- comment -->
        {% set avatar_letter = student.name[0]|upper if student.name else 'U' %} {# comment #}
        <section class="hero"> <!-- comment -->
            <div class="hero-top"> <!-- comment -->
                <div class="hero-left"> <!-- comment -->
                    {% if student_user and student_user.avatar_url %} <!-- comment -->
                    <img class="avatar" src="{{ student_user.avatar_url }}" alt="–ê–≤–∞—Ç–∞—Ä"> <!-- comment -->
                    {% else %} <!-- comment -->
                    <div class="avatar">{{ avatar_letter }}</div> <!-- comment -->
                    {% endif %} <!-- comment -->
                    <div> <!-- comment -->
                        <h1 style="margin: 0 0 0.2rem 0;">{{ student.name }}</h1> <!-- comment -->
                        <div class="hero-meta"> <!-- comment -->
                            <div>üéØ –¶–µ–ª—å: {{ student.target_score or '–Ω–µ –∑–∞–¥–∞–Ω–∞' }}</div> <!-- comment -->
                            <div>üéì –ö–ª–∞—Å—Å: {{ student.school_class or '‚Äî' }}</div> <!-- comment -->
                            <div>üìö –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ student.category or '‚Äî' }}</div> <!-- comment -->
                            <div>üìÖ –î–µ–¥–ª–∞–π–Ω: {{ student.deadline or '‚Äî' }}</div> <!-- comment -->
                        </div> <!-- comment -->
                    </div> <!-- comment -->
                </div> <!-- comment -->
                <div class="action-row"> <!-- comment -->
                    <a href="{{ url_for('students.student_analytics', student_id=student.student_id) }}" class="neo-button outline">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</a> <!-- comment -->
                    {% if not current_user.is_student() and not current_user.is_parent() %} <!-- comment -->
                    <a href="{{ url_for('students.lesson_new', student_id=student.student_id) }}" class="neo-button accent">‚ûï –ù–æ–≤—ã–π —É—Ä–æ–∫</a> <!-- comment -->
                    <a href="{{ url_for('students.student_edit', student_id=student.student_id) }}" class="neo-button outline">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a> <!-- comment -->
                    {% endif %} <!-- comment -->
                    <a href="{{ url_for('main.dashboard') }}" class="neo-button outline">‚¨Ö –ö —Å–ø–∏—Å–∫—É</a> <!-- comment -->
                </div> <!-- comment -->
            </div> <!-- comment -->
        </section> <!-- comment -->

        {% set workflow_state = 'plan' %} {# comment #}
        {% if in_progress_lesson %} {% set workflow_state = 'lesson' %} {% endif %} {# comment #}
        {% if active_submissions and not in_progress_lesson %} {% set workflow_state = 'homework' %} {% endif %} {# comment #}
        <section class="grid" style="margin-bottom: 1.5rem;"> <!-- comment -->
            <div class="panel"> <!-- comment -->
                <h3>–£—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å</h3> <!-- comment -->
                <div class="workflow"> <!-- comment -->
                    <div class="workflow-step {% if workflow_state == 'plan' %}active{% endif %}">1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: —Å–æ–∑–¥–∞—ë–º —É—Ä–æ–∫, —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ü–µ–ª—å, –≥–æ—Ç–æ–≤–∏–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã</div> <!-- comment -->
                    <div class="workflow-step {% if workflow_state == 'lesson' %}active{% endif %}">2. –£—Ä–æ–∫: –∫–æ–Ω—Å–ø–µ–∫—Ç, –ø—Ä–∞–∫—Ç–∏–∫–∞, —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</div> <!-- comment -->
                    <div class="workflow-step {% if workflow_state == 'homework' %}active{% endif %}">3. –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∞–≤—Ç–æ‚Äë–ø—Ä–æ–≤–µ—Ä–∫–∞, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</div> <!-- comment -->
                    <div class="workflow-step {% if workflow_state == 'review' %}active{% endif %}">4. –ü—Ä–æ–≤–µ—Ä–∫–∞: –æ—Ü–µ–Ω–∫–∞, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</div> <!-- comment -->
                    <div class="workflow-step {% if workflow_state == 'summary' %}active{% endif %}">5. –ò—Ç–æ–≥–∏: —Ñ–∏–∫—Å–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –ø–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞</div> <!-- comment -->
                </div> <!-- comment -->
            </div> <!-- comment -->
            <div class="panel"> <!-- comment -->
                <h3>–°–µ–π—á–∞—Å –≤ —Ä–∞–±–æ—Ç–µ</h3> <!-- comment -->
                {% if in_progress_lesson %} <!-- comment -->
                <div class="lesson-card"> <!-- comment -->
                    <div class="lesson-title">üü¢ –ò–¥—ë—Ç —É—Ä–æ–∫: {{ in_progress_lesson.topic or '–¢–µ–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞' }}</div> <!-- comment -->
                    <div class="lesson-meta"> <!-- comment -->
                        <div>‚è± {{ in_progress_lesson.duration }} –º–∏–Ω</div> <!-- comment -->
                        <div>üìÖ {{ in_progress_lesson.lesson_date.strftime('%d.%m.%Y %H:%M') }}</div> <!-- comment -->
                    </div> <!-- comment -->
                    <div class="lesson-actions"> <!-- comment -->
                        <a class="neo-button accent sm" href="{{ url_for('lessons.lesson_homework_view', lesson_id=in_progress_lesson.lesson_id) }}">–û—Ç–∫—Ä—ã—Ç—å —Ä–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</a> <!-- comment -->
                        {% if not current_user.is_student() and not current_user.is_parent() %} <!-- comment -->
                        <form method="POST" action="{{ url_for('lessons.lesson_complete', lesson_id=in_progress_lesson.lesson_id) }}"> <!-- comment -->
                            {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %} <!-- comment -->
                            <input type="hidden" name="topic" value="{{ in_progress_lesson.topic or '' }}"> <!-- comment -->
                            <input type="hidden" name="notes" value="{{ in_progress_lesson.notes or '' }}"> <!-- comment -->
                            <input type="hidden" name="homework" value="{{ in_progress_lesson.homework or '' }}"> <!-- comment -->
                            <button type="submit" class="neo-button outline sm">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫</button> <!-- comment -->
                        </form> <!-- comment -->
                        {% endif %} <!-- comment -->
                    </div> <!-- comment -->
                </div> <!-- comment -->
                {% else %} <!-- comment -->
                <div class="muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É—Ä–æ–∫–∞. –ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π.</div> <!-- comment -->
                {% endif %} <!-- comment -->
            </div> <!-- comment -->
        </section> <!-- comment -->

        <section class="grid" style="margin-bottom: 1.5rem;"> <!-- comment -->
            <div class="panel"> <!-- comment -->
                <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h3> <!-- comment -->
                {% if active_submissions %} <!-- comment -->
                <div class="submissions-list"> <!-- comment -->
                    {% for submission in active_submissions %} <!-- comment -->
                    <div class="submission-item"> <!-- comment -->
                        <div> <!-- comment -->
                            <div><strong>{{ submission.assignment.title }}</strong></div> <!-- comment -->
                            <div class="muted">–°—Ç–∞—Ç—É—Å: {{ submission.status }}</div> <!-- comment -->
                        </div> <!-- comment -->
                        <a class="neo-button outline sm" href="{{ url_for('assignments.submission_view', submission_id=submission.submission_id) }}">–û—Ç–∫—Ä—ã—Ç—å</a> <!-- comment -->
                    </div> <!-- comment -->
                    {% endfor %} <!-- comment -->
                </div> <!-- comment -->
                {% else %} <!-- comment -->
                <div class="muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–±–æ—Ç. –ö–æ–≥–¥–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–∏—Ç –∑–∞–¥–∞–Ω–∏—è, –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</div> <!-- comment -->
                {% endif %} <!-- comment -->
            </div> <!-- comment -->
            <div class="panel"> <!-- comment -->
                <h3>–°–≤—è–∑–∏ –∏ –¥–æ—Å—Ç—É–ø</h3> <!-- comment -->
                {% if parents_info and parents_info|length > 0 %} <!-- comment -->
                <div class="submissions-list"> <!-- comment -->
                    {% for parent in parents_info %} <!-- comment -->
                    <div class="submission-item"> <!-- comment -->
                        <div> <!-- comment -->
                            <div><strong>{{ parent.name }}</strong></div> <!-- comment -->
                            <div class="muted">–î–æ—Å—Ç—É–ø: {{ parent.access_level }}</div> <!-- comment -->
                        </div> <!-- comment -->
                        <div class="muted">{{ parent.phone or '–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω' }}</div> <!-- comment -->
                    </div> <!-- comment -->
                    {% endfor %} <!-- comment -->
                </div> <!-- comment -->
                {% else %} <!-- comment -->
                <div class="muted">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–¥–∏—Ç–µ–ª—è—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞.</div> <!-- comment -->
                {% endif %} <!-- comment -->
            </div> <!-- comment -->
        </section> <!-- comment -->

        <section class="panel"> <!-- comment -->
            <h3>–õ–µ–Ω—Ç–∞ —É—Ä–æ–∫–æ–≤</h3> <!-- comment -->
            <div class="filter-row"> <!-- comment -->
                <input id="lessonSearch" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–º–µ –∏–ª–∏ –∑–∞–º–µ—Ç–∫–∞–º..."> <!-- comment -->
                <select id="lessonStatusFilter"> <!-- comment -->
                    <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option> <!-- comment -->
                    <option value="planned">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</option> <!-- comment -->
                    <option value="in_progress">–ò–¥—ë—Ç</option> <!-- comment -->
                    <option value="completed">–ü—Ä–æ–≤–µ–¥—ë–Ω</option> <!-- comment -->
                </select> <!-- comment -->
            </div> <!-- comment -->
            <div class="grid" id="lessonList"> <!-- comment -->
                {% for lesson in lessons %} <!-- comment -->
                <div class="lesson-card" data-status="{{ lesson.status }}" data-search="{{ (lesson.topic or '')|lower }} {{ (lesson.notes or '')|lower }}"> <!-- comment -->
                    <div class="lesson-title">{{ lesson.topic or '–¢–µ–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞' }}</div> <!-- comment -->
                    <div class="lesson-meta"> <!-- comment -->
                        <div>üìÖ {{ lesson.lesson_date.strftime('%d.%m.%Y %H:%M') }}</div> <!-- comment -->
                        <div>‚è± {{ lesson.duration }} –º–∏–Ω</div> <!-- comment -->
                        <div>üìå –°—Ç–∞—Ç—É—Å: {{ lesson.status }}</div> <!-- comment -->
                        <div>üè† –î–ó: {{ lesson.homework_status }}</div> <!-- comment -->
                    </div> <!-- comment -->
                    <div> <!-- comment -->
                        {% if lesson.content %}<span class="badge">üìñ –ï—Å—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç</span>{% endif %} <!-- comment -->
                        {% if lesson.materials %}<span class="badge">üìé –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</span>{% endif %} <!-- comment -->
                        {% if lesson.homework_assignments and lesson.homework_assignments|length > 0 %} <!-- comment -->
                        <span class="badge">üß© –ó–∞–¥–∞–Ω–∏–π: {{ lesson.homework_assignments|length }}</span> <!-- comment -->
                        {% endif %} <!-- comment -->
                    </div> <!-- comment -->
                    <div class="lesson-actions"> <!-- comment -->
                        <a class="neo-button accent sm" href="{{ url_for('lessons.lesson_homework_view', lesson_id=lesson.lesson_id) }}">–†–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</a> <!-- comment -->
                        {% if not current_user.is_student() and not current_user.is_parent() %} <!-- comment -->
                        <form method="POST" action="{{ url_for('lessons.lesson_start', lesson_id=lesson.lesson_id) }}"> <!-- comment -->
                            {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %} <!-- comment -->
                            <button type="submit" class="neo-button outline sm">‚ñ∂ –ù–∞—á–∞—Ç—å —É—Ä–æ–∫</button> <!-- comment -->
                        </form> <!-- comment -->
                        <a class="neo-button outline sm" href="{{ url_for('lessons.lesson_edit', lesson_id=lesson.lesson_id) }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a> <!-- comment -->
                        {% endif %} <!-- comment -->
                    </div> <!-- comment -->
                </div> <!-- comment -->
                {% endfor %} <!-- comment -->
                {% if lessons|length == 0 %} <!-- comment -->
                <div class="muted">–£—Ä–æ–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è.</div> <!-- comment -->
                {% endif %} <!-- comment -->
            </div> <!-- comment -->
        </section> <!-- comment -->
    </main> <!-- comment -->

    <script src="{{ url_for('static', filename='toast.js') }}"></script> <!-- comment -->
    <script> // comment
        const lessonSearch = document.getElementById('lessonSearch'); // comment
        const statusFilter = document.getElementById('lessonStatusFilter'); // comment
        const lessonList = document.getElementById('lessonList'); // comment
        function applyFilters() { // comment
            if (!lessonList) return; // comment
            const q = (lessonSearch.value || '').trim().toLowerCase(); // comment
            const status = statusFilter.value; // comment
            lessonList.querySelectorAll('.lesson-card').forEach(card => { // comment
                const cardStatus = card.getAttribute('data-status'); // comment
                const searchable = card.getAttribute('data-search') || ''; // comment
                const statusOk = (status === 'all') || (cardStatus === status); // comment
                const textOk = !q || searchable.includes(q); // comment
                card.style.display = (statusOk && textOk) ? 'grid' : 'none'; // comment
            }); // comment
        } // comment
        if (lessonSearch) lessonSearch.addEventListener('input', applyFilters); // comment
        if (statusFilter) statusFilter.addEventListener('change', applyFilters); // comment
    </script> <!-- comment -->
</body> <!-- comment -->
</html> <!-- comment -->
