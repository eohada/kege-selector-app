<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ¬∑ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% include '_ux_enhancements.html' %}
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
    <style>
        .hero {
            background: linear-gradient(135deg, rgba(0, 255, 213, 0.06), rgba(31, 123, 255, 0.06));
            border: 1px solid var(--stroke-1);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-top: 1.25rem;
            margin-bottom: 1rem;
        }
        .hero h1 { margin: 0.35rem 0 0 0; font-size: 2.15rem; font-weight: 900; }
        .hero p { margin: 0.65rem 0 0 0; color: var(--text-muted); line-height: 1.45; }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }
        .panel {
            background: var(--surface-1);
            border: 1px solid var(--stroke-1);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
        }
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 0.9rem;
        }
        .asset-card {
            background: var(--surface-2);
            border: 1px solid var(--stroke-1);
            border-radius: var(--radius-md);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            position: relative;
            transition: transform 0.2s, border-color 0.2s, background 0.2s;
        }
        .asset-card:hover { transform: translateY(-2px); border-color: rgba(0,255,213,0.35); background: rgba(255,255,255,0.04); }
        .asset-title { font-weight: 900; line-height: 1.25; }
        .asset-meta { color: var(--text-muted); font-size: 0.9rem; display: flex; gap: 0.65rem; flex-wrap: wrap; }
        .tags { display: flex; gap: 0.35rem; flex-wrap: wrap; }
        .tag {
            padding: 0.18rem 0.5rem;
            border-radius: 999px;
            border: 1px solid var(--stroke-1);
            background: rgba(255,255,255,0.03);
            color: var(--text-muted);
            font-size: 0.82rem;
            font-weight: 700;
        }
        .danger-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .asset-card:hover .danger-btn { opacity: 1; }
        .field-label { display:block; color: var(--text-muted); font-weight: 800; font-size: 0.9rem; margin-bottom: 0.35rem; }
    </style>
</head>
<body>
    <div class="app-shell">
        {% set active_page = 'library' %}
        {% include '_primary_nav.html' %}

        <main>
            <section class="hero">
                <div class="hero-eyebrow">–ö–æ–Ω—Ç–µ–Ω—Ç –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</div>
                <h1>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h1>
                <p>–•—Ä–∞–Ω–∏ —Ä–∞–∑–¥–∞—Ç–∫–∏, —Ñ–∞–π–ª—ã –∏ –æ–ø–æ—Ä—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–π –∫ –ª—é–±—ã–º —É—Ä–æ–∫–∞–º. –°–µ–π—á–∞—Å —ç—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–¥–ª—è —Ç–≤–æ–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞) ‚Äî –¥–∞–ª—å—à–µ –¥–æ–±–∞–≤–∏–º shared –∏ —Ç–µ–≥–∏.</p>
            </section>

            <div class="grid">
                <section class="panel">
                    <div style="display:flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        <h2 style="margin: 0; font-size: 1.15rem; font-weight: 900;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª</h2>
                    </div>
                    <form method="POST" action="{{ url_for('library.materials_upload') }}" enctype="multipart/form-data" style="margin-top: 1rem;">
                        {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %}
                        <div style="display:grid; grid-template-columns: 1fr; gap: 0.85rem;">
                            <div>
                                <label class="field-label">–§–∞–π–ª</label>
                                <input class="neo-input" type="file" name="file" required>
                            </div>
                            <div>
                                <label class="field-label">–ù–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                <input class="neo-input" name="title" placeholder="–ù–∞–ø—Ä.: –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç–∏ ‚Äî —à–ø–∞—Ä–≥–∞–ª–∫–∞">
                            </div>
                            <div>
                                <label class="field-label">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                                <input class="neo-input" name="tags" placeholder="–µ–≥—ç, 24, –ø–∏—Ç–æ–Ω, —à–ø–æ—Ä–∞">
                            </div>
                            <div>
                                <label class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                <textarea class="neo-textarea" name="description" placeholder="–ö–æ—Ä–æ—Ç–∫–æ: –¥–ª—è —á–µ–≥–æ, –∫–æ–≥–¥–∞ –≤—ã–¥–∞–≤–∞—Ç—å, –Ω—é–∞–Ω—Å—ã..."></textarea>
                            </div>
                            <div style="display:flex; justify-content: flex-end;">
                                <button class="neo-button accent" type="submit">
                                    <i class="fas fa-cloud-upload-alt ui-icon ui-icon--sm"></i> –î–æ–±–∞–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </form>
                </section>

                <section class="panel">
                    <div style="display:flex; justify-content: space-between; align-items: flex-end; gap: 1rem; flex-wrap: wrap;">
                        <div>
                            <h2 style="margin: 0; font-size: 1.15rem; font-weight: 900;">–ú–æ–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h2>
                            <div style="color: var(--text-muted); margin-top: 0.35rem;">{{ assets|length }} —à—Ç.</div>
                        </div>
                        <form method="GET" style="display:flex; gap: 0.6rem; align-items: center; flex-wrap: wrap;">
                            <input class="neo-input" name="q" value="{{ q }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶" style="min-width: 240px;">
                            <input class="neo-input" name="tag" value="{{ tag }}" placeholder="–¢–µ–≥" style="width: 120px;">
                            <button class="neo-button outline" type="submit"><i class="fas fa-search"></i></button>
                            <a class="neo-button ghost" href="{{ url_for('library.materials_library') }}"><i class="fas fa-rotate-left"></i></a>
                        </form>
                    </div>

                    <div style="margin-top: 1rem;">
                        {% if assets and assets|length > 0 %}
                        <div class="assets-grid">
                            {% for a in assets %}
                            <div class="asset-card">
                                <form method="POST" action="{{ url_for('library.materials_delete', asset_id=a.asset_id) }}" class="danger-btn">
                                    {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %}
                                    <button type="submit" class="neo-button danger sm" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏?');">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                                <div class="asset-title">{{ a.title }}</div>
                                <div class="asset-meta">
                                    <span><i class="far fa-file"></i> {{ a.file_name }}</span>
                                    {% if a.file_size %}<span><i class="fas fa-weight-hanging"></i> {{ (a.file_size/1024)|round(0) }} KB</span>{% endif %}
                                </div>
                                {% if a.tags and a.tags|length > 0 %}
                                <div class="tags">
                                    {% for t in a.tags %}
                                    <a class="tag" href="{{ url_for('library.materials_library', tag=t) }}">{{ t }}</a>
                                    {% endfor %}
                                </div>
                                {% endif %}
                                <div style="display:flex; gap: 0.6rem; flex-wrap: wrap; margin-top: 0.25rem;">
                                    <a class="neo-button outline sm" href="{{ a.file_url }}" target="_blank">
                                        <i class="fas fa-arrow-up-right-from-square"></i> –û—Ç–∫—Ä—ã—Ç—å
                                    </a>
                                    <a class="neo-button ghost sm" href="{{ a.file_url }}" download>
                                        <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å
                                    </a>
                                </div>
                                {% if a.description %}
                                <div style="color: var(--text-muted); font-size: 0.92rem; line-height: 1.45; margin-top: 0.25rem;">
                                    {{ a.description }}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="glass-panel" style="padding: 1.5rem; text-align:center;">
                            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìé</div>
                            <div style="font-weight: 900;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>
                            <div style="color: var(--text-muted); margin-top: 0.35rem;">–ó–∞–≥—Ä—É–∑–∏ –ø–µ—Ä–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª ‚Äî –∏ –æ–Ω –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.</div>
                        </div>
                        {% endif %}
                    </div>
                </section>
            </div>
        </main>
    </div>
</body>
</html>

