<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - {{ student.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    {% include '_ux_enhancements.html' %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
</head>
<body class="{% if active_lesson %}lesson-active{% endif %}">
    {% if active_lesson and active_student %}
    <div class="now-playing-pill" onclick="toggleLessonMenu()">
        üéß –£—Ä–æ–∫ –∏–¥–µ—Ç: {{ active_student.name }}
    </div>
    <div class="now-playing-panel" id="lessonMenu">
        <div class="hero-eyebrow">—Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫</div>
        <p style="margin: 0 0 0.4rem 0;"><strong>–£—á–µ–Ω–∏–∫:</strong> {{ active_student.name }}</p>
        {% if active_lesson.topic %}
        <p style="margin: 0 0 0.4rem 0;"><strong>–¢–µ–º–∞:</strong> {{ active_lesson.topic }}</p>
        {% endif %}
        <p style="margin: 0 0 0.4rem 0;"><strong>–î–∞—Ç–∞:</strong> {{ active_lesson.lesson_date.strftime('%d.%m.%Y %H:%M') }}</p>
        <p style="margin: 0;"><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ active_lesson.duration }} –º–∏–Ω—É—Ç</p>
        <div class="hero-actions" style="margin-top: 1rem;">
            <form method="POST" action="{{ url_for('lessons.lesson_complete', lesson_id=active_lesson.lesson_id) }}">
                <button type="submit" class="neo-button accent">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
            </form>
            <a href="{{ url_for('students.student_profile', student_id=active_student.student_id) }}" class="neo-button ghost">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        </div>
    </div>
    <script>
        function toggleLessonMenu() {
            const menu = document.getElementById('lessonMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
    </script>
    {% endif %}
    
    <header class="nav-primary">
        <div class="nav-brand">
            {% if current_user and current_user.is_authenticated %}
            <a href="{{ url_for('auth.user_profile') }}" class="user-profile-avatar {% if current_user.is_creator() %}creator{% endif %}" title="{{ current_user.username }} ({{ current_user.get_role_display() }})">
                {{ current_user.username[0].upper() }}
            </a>
            {% endif %}
            <a href="{{ url_for('main.index') }}" style="text-decoration: none; display: flex; align-items: center; gap: 1rem; color: inherit;">
                <div class="brand-mark">LOGO</div>
                <div class="brand-caption">–°–ª–æ—Ç –ø–æ–¥ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∑–Ω–∞–∫</div>
            </a>
        </div>
        {% include '_mobile_menu.html' %}
        <nav class="nav-links">
            <a href="{{ url_for('main.dashboard') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/students_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –£—á–µ–Ω–∏–∫–∏" class="nav-link-icon">
                    <span class="nav-link-label">–£—á–µ–Ω–∏–∫–∏</span>
                </span>
            </a>
            <a href="{{ url_for('schedule.schedule') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/schedule_white.png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" class="nav-link-icon">
                    <span class="nav-link-label">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
                </span>
            </a>
            <a href="{{ url_for('kege_generator.kege_generator') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/generator_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä" class="nav-link-icon">
                    <span class="nav-link-label">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</span>
                </span>
            </a>
            <a href="{{ url_for('main.update_plans') }}" class="nav-link">
                <span class="nav-link-content">
                    <img src="{{ url_for('static', filename='icons/notes_white-no-bg-preview (carve.photos).png') }}" alt="–ò–∫–æ–Ω–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ –ü–ª–∞–Ω—ã" class="nav-link-icon">
                    <span class="nav-link-label">–ü–ª–∞–Ω—ã</span>
                </span>
            </a>
        </nav>
    </header>
    
    <div class="app-shell">
        <section class="glass-panel" style="margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <a href="{{ url_for('students.student_profile', student_id=student.student_id) }}" class="neo-button ghost" style="text-decoration: none;">
                    ‚Üê –ö –ø—Ä–æ—Ñ–∏–ª—é
                </a>
            </div>
            <p class="hero-eyebrow">—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</p>
            <h1 class="hero-title">üìä {{ student.name }}</h1>
            <p class="hero-subtitle">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –ø–æ –Ω–æ–º–µ—Ä–∞–º</p>
        </section>
        
        {% if chart_data %}
        <section class="glass-panel">
            <div class="panel-head">
                <div>
                    <p class="eyebrow">–¥–∏–∞–≥—Ä–∞–º–º–∞</p>
                    <h2>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π</h2>
                </div>
            </div>
            
            <div style="margin-top: 2rem;">
                <canvas id="statisticsChart" style="max-height: 500px;"></canvas>
            </div>
            
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--stroke-1);">
                <h3 style="margin-bottom: 1rem; font-size: 1.1em;">–õ–µ–≥–µ–Ω–¥–∞ —Ü–≤–µ—Ç–æ–≤:</h3>
                <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 20px; height: 20px; background: #ef4444; border-radius: 4px;"></div>
                        <span>0-40% (—Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è)</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 20px; height: 20px; background: #eab308; border-radius: 4px;"></div>
                        <span>40-80% (—Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 20px; height: 20px; background: #22c55e; border-radius: 4px;"></div>
                        <span>80-100% (–æ—Ç–ª–∏—á–Ω–æ)</span>
                    </div>
                </div>
                <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9em;">
                    <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Å –≤–µ—Å–æ–º √ó2 (–æ–¥–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ = –¥–≤–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö).
                </p>
            </div>
        </section>
        
        <section class="glass-panel">
            <div class="panel-head">
                <div>
                    <p class="eyebrow">—Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
                    <h2>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</h2>
                </div>
            </div>
            
            <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9em;">
                –í—ã –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–º–µ—Ä–∞. 
                –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –ø—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö.
            </p>
            
            <div style="margin-top: 2rem;">
                <div id="statisticsEditor" style="display: grid; gap: 1rem;">
                    {% for item in chart_data %}
                    <div class="stat-edit-item" data-task-number="{{ item.task_number }}" style="display: grid; grid-template-columns: 120px 1fr 1fr auto; gap: 1rem; align-items: center; padding: 1rem; background: var(--bg-2); border-radius: 8px;">
                        <div>
                            <strong>–ó–∞–¥–∞–Ω–∏–µ {{ item.task_number }}</strong>
                            <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 0.25rem;">
                                {{ item.correct }}/{{ item.total }} ({{ item.percent }}%)
                            </div>
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.9em; margin-bottom: 0.25rem; color: var(--text-muted);">
                                ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–¥–æ–±–∞–≤–∏—Ç—å):
                            </label>
                            <input type="number" 
                                   min="0" 
                                   step="1"
                                   class="stat-input-correct" 
                                   value="0"
                                   placeholder="–°–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å"
                                   style="width: 100%; padding: 0.5rem; border: 1px solid var(--stroke-1); border-radius: 4px; background: var(--bg-1); color: var(--text-primary);">
                            {% if item.manual_correct > 0 %}
                            <small style="display: block; margin-top: 0.25rem; color: var(--text-muted); font-size: 0.85em;">
                                –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ: {{ item.manual_correct }}
                            </small>
                            {% endif %}
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.9em; margin-bottom: 0.25rem; color: var(--text-muted);">
                                ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–¥–æ–±–∞–≤–∏—Ç—å):
                            </label>
                            <input type="number" 
                                   min="0" 
                                   step="1"
                                   class="stat-input-incorrect" 
                                   value="0"
                                   placeholder="–°–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å"
                                   style="width: 100%; padding: 0.5rem; border: 1px solid var(--stroke-1); border-radius: 4px; background: var(--bg-1); color: var(--text-primary);">
                            {% if item.manual_incorrect > 0 %}
                            <small style="display: block; margin-top: 0.25rem; color: var(--text-muted); font-size: 0.85em;">
                                –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ: {{ item.manual_incorrect }}
                            </small>
                            {% endif %}
                        </div>
                        <div>
                            <button type="button" 
                                    class="neo-button accent stat-save-btn" 
                                    data-task-number="{{ item.task_number }}"
                                    style="white-space: nowrap;">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>
        {% else %}
        <section class="glass-panel">
            <div class="empty-state">
                <div style="font-size: 4rem; margin-bottom: 0.6rem;">üìä</div>
                <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h3>
                <p style="color: var(--text-muted);">–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.</p>
            </div>
        </section>
        {% endif %}
    </div>
    
    <script src="{{ url_for('static', filename='toast.js') }}"></script>
    <script src="{{ url_for('static', filename='flash-to-toast.js') }}"></script>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –µ—Å–ª–∏ toast –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
        function showTemporaryNotification(message, type) {
            // –ü—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å toast –∏–∑ toast.js
            if (typeof toast !== 'undefined' && toast && typeof toast.show === 'function') {
                toast.show(message, type);
                return;
            }
            if (window.toast && typeof window.toast.show === 'function') {
                window.toast.show(message, type);
                return;
            }
            if (typeof toast !== 'undefined' && toast) {
                if (type === 'success' && typeof toast.success === 'function') {
                    toast.success(message);
                    return;
                }
                if (type === 'error' && typeof toast.error === 'function') {
                    toast.error(message);
                    return;
                }
            }
            
            // Fallback: —Å–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                background: ${type === 'success' ? '#22c55e' : '#ef4444'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 10000;
                font-size: 14px;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            const saveButtons = document.querySelectorAll('.stat-save-btn');
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
            
            if (!csrfToken) {
                console.warn('CSRF —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            saveButtons.forEach(btn => {
                btn.addEventListener('click', async function() {
                    const taskNumber = parseInt(this.dataset.taskNumber);
                    const item = this.closest('.stat-edit-item');
                    const correctInput = item.querySelector('.stat-input-correct');
                    const incorrectInput = item.querySelector('.stat-input-incorrect');
                    
                    const manualCorrect = parseInt(correctInput.value) || 0;
                    const manualIncorrect = parseInt(incorrectInput.value) || 0;
                    
                    // –í–∞–ª–∏–¥–∞—Ü–∏—è
                    if (manualCorrect < 0 || manualIncorrect < 0) {
                        showTemporaryNotification('–ó–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏', 'error');
                        return;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    const originalText = this.innerHTML;
                    this.innerHTML = '‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
                    this.disabled = true;
                    
                    try {
                        const url = `{{ url_for('students.update_statistics', student_id=student.student_id) }}`;
                        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞:', url);
                        console.log('–î–∞–Ω–Ω—ã–µ:', { task_number: taskNumber, manual_correct: manualCorrect, manual_incorrect: manualIncorrect });
                        
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': csrfToken || ''
                            },
                            body: JSON.stringify({
                                task_number: taskNumber,
                                manual_correct: manualCorrect,
                                manual_incorrect: manualIncorrect
                            })
                        });
                        
                        console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
                        console.log('–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', response.headers);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error('–û—à–∏–±–∫–∞ HTTP:', response.status, errorText);
                            throw new Error(`HTTP ${response.status}: ${errorText}`);
                        }
                        
                        const data = await response.json();
                        console.log('–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                        
                        if (data && data.success) {
                            showTemporaryNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–µ—à–∞
                            setTimeout(() => {
                                // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫–µ—à–∞
                                const url = new URL(window.location.href);
                                url.searchParams.set('_t', Date.now());
                                window.location.href = url.toString();
                            }, 1000);
                        } else {
                            const errorMsg = data?.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏';
                            console.error('–û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', errorMsg);
                            showTemporaryNotification(errorMsg, 'error');
                            this.innerHTML = originalText;
                            this.disabled = false;
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                        showTemporaryNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + error.message, 'error');
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }
                });
            });
        });
    </script>
    
    {% if chart_data %}
    <script>
        const chartData = {{ chart_data|tojson }};
        
        const ctx = document.getElementById('statisticsChart').getContext('2d');
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.map(item => '–ó–∞–¥–∞–Ω–∏–µ ' + item.task_number),
                datasets: [{
                    label: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (%)',
                    data: chartData.map(item => item.percent),
                    backgroundColor: chartData.map(item => item.color),
                    borderColor: chartData.map(item => item.color),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const dataIndex = context.dataIndex;
                                const item = chartData[dataIndex];
                                return `–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${item.correct}/${item.total} (${item.percent}%)`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        title: {
                            display: true,
                            text: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '–ù–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è'
                        }
                    }
                }
            }
        });
    </script>
    {% endif %}
</body>
</html>

