# Генератор уникальных заданий КЕГЭ

Система для автоматизированного подбора заданий с отслеживанием истории использования.

## Возможности

- ✅ Парсинг всех 27 типов заданий с сайта kompege.ru
- ✅ Автоматическое извлечение прикрепленных файлов (Excel, текстовые файлы)
- ✅ Три состояния заданий:
  - **Принято** - задание сохранено и больше не будет показываться
  - **Пропущено** - задание можно вернуть в выборку позже
  - **Черный список** - задание никогда не будет показываться
- ✅ Массовые операции с заданиями
- ✅ Работа с пропущенными заданиями
- ✅ Сброс истории использования

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Установите браузеры для Playwright:
```bash
playwright install chromium
```

3. Инициализируйте базу данных:
```bash
flask init-db
```

## Использование

### 1. Запуск парсера

Запустите парсер для заполнения базы данных заданиями:

```bash
python scraper/playwright_parser.py
```

Парсер автоматически обработает все 27 типов заданий. Процесс может занять некоторое время.

### 2. Запуск веб-приложения

```bash
python app.py
```

Или через Flask:

```bash
flask run
```

Приложение будет доступно по адресу: http://127.0.0.1:5000

### 3. Работа с заданиями

1. **Выбор заданий:**
   - Выберите тип задания (1-27)
   - Укажите количество заданий
   - Опционально включите "Включить пропущенные задания"
   - Нажмите "Сгенерировать Набор"

2. **Действия с заданиями:**
   - **Принять** - задание сохраняется и больше не показывается
   - **Пропустить** - задание можно вернуть в выборку позже
   - **В черный список** - задание никогда не будет показываться

3. **Массовые операции:**
   - Используйте чекбоксы для выбора нескольких заданий
   - Нажмите соответствующую кнопку для массового действия

4. **Скачивание файлов:**
   - Если в задании есть прикрепленные файлы (Excel, текстовые), они отображаются в отдельном блоке
   - Нажмите на ссылку файла для скачивания

## Структура проекта

```
kege_selector_app/
├── app.py                 # Основное Flask приложение
├── core/
│   ├── db_models.py       # Модели базы данных
│   └── selector_logic.py  # Логика выбора заданий
├── scraper/
│   └── playwright_parser.py  # Парсер заданий
├── templates/
│   ├── index.html         # Главная страница
│   └── results.html       # Страница результатов
├── data/
│   └── keg_tasks.db       # База данных SQLite
└── requirements.txt        # Зависимости
```

## База данных

Система использует SQLite с следующими таблицами:

- **Tasks** - основная таблица заданий
- **UsageHistory** - принятые задания
- **SkippedTasks** - пропущенные задания
- **BlacklistTasks** - черный список заданий

## Особенности парсера

- Использует Playwright с stealth-режимом для обхода детекции ботов
- Автоматически извлекает файлы из заданий
- Обрабатывает все 27 типов заданий
- Сохраняет полный HTML-контент заданий
- Формирует правильные URL для каждого задания

## Примечания

- Парсер работает в видимом режиме браузера (headless=False) для отладки
- Между запросами есть задержка для соблюдения правил robots.txt
- Все задания сохраняются с полным контентом для офлайн-доступа

