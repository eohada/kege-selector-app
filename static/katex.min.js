(function () {
  'use strict';

  // Shim для окружений/страниц, которые по ошибке подключают /static/katex.min.js
  // Реальный файл лежит в /static/katex/katex/katex.min.js
  if (window.katex && typeof window.katex.render === 'function') {
    return;
  }
  if (window.__katexShimLoading) {
    return;
  }
  window.__katexShimLoading = true;

  try {
    var existing = document.querySelector('script[data-katex-shim="1"]');
    if (existing) {
      return;
    }
  } catch (e) {}

  function load() {
    try {
      var s = document.createElement('script');
      s.defer = true;
      s.setAttribute('data-katex-shim', '1');
      s.src = '/static/katex/katex/katex.min.js';
      s.onload = function () {
        try {
          window.__katexShimLoading = false;
          window.dispatchEvent(new CustomEvent('katex:ready'));
        } catch (e) {}
      };
      s.onerror = function () {
        try {
          window.__katexShimLoading = false;
        } catch (e) {}
      };
      (document.head || document.documentElement).appendChild(s);
    } catch (e) {
      try {
        window.__katexShimLoading = false;
      } catch (e2) {}
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', load);
  } else {
    load();
  }
})();

