<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ assignment.title }} - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–±–æ—Ç—ã</title>
    {% if csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
    <link rel="stylesheet" href="{{ url_for('static', filename='modern_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='toast.css') }}">
    {% include '_ux_enhancements.html' %}
</head>
<body>
    {% include '_primary_nav.html' %}
    
    <main class="container" style="max-width: 1400px; margin: 2rem auto; padding: 0 1.5rem;">
        <div style="margin-bottom: 2rem;">
            <a href="{{ url_for('assignments.assignments_list') }}" class="btn-secondary" style="display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —Ä–∞–±–æ—Ç
            </a>
            <h1 style="font-size: 2.5em; font-weight: 800; margin-bottom: 0.5rem;">{{ assignment.title }}</h1>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                <span class="badge" style="padding: 0.5rem 1rem; border-radius: var(--radius-sm); font-weight: 600;">
                    {% if assignment.assignment_type == 'homework' %}–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
                    {% elif assignment.assignment_type == 'classwork' %}–ö–ª–∞—Å—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
                    {% elif assignment.assignment_type == 'exam' %}–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞
                    {% else %}{{ assignment.assignment_type }}{% endif %}
                </span>
                <span style="color: var(--text-muted);">üìÖ –î–µ–¥–ª–∞–π–Ω: {{ assignment.deadline.strftime('%d.%m.%Y %H:%M') }}</span>
                <span style="color: var(--text-muted);">üìù –ó–∞–¥–∞—á: {{ assignment.tasks|length }}</span>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
            <div>
                <h2 style="font-size: 1.5em; margin-bottom: 1rem;">–ó–∞–¥–∞—á–∏ –≤ —Ä–∞–±–æ—Ç–µ</h2>
                {% for task in assignment.tasks|sort(attribute='order_index') %}
                <div style="background: var(--surface-1); border: 1px solid var(--stroke-1); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div>
                            <div style="font-size: 1.2em; font-weight: 700; color: var(--accent-1);">
                                –ó–∞–¥–∞–Ω–∏–µ {{ task.task.task_number }}
                            </div>
                            <div style="font-size: 0.9em; color: var(--text-muted); margin-top: 0.25rem;">
                                –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª: {{ task.max_score }}
                            </div>
                        </div>
                        {% if task.requires_manual_grading %}
                        <span class="badge" style="background: var(--warning); color: white; padding: 0.25rem 0.75rem; border-radius: var(--radius-sm);">
                            –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                        </span>
                        {% else %}
                        <span class="badge" style="background: var(--success); color: white; padding: 0.25rem 0.75rem; border-radius: var(--radius-sm);">
                            –ê–≤—Ç–æ-–ø—Ä–æ–≤–µ—Ä–∫–∞
                        </span>
                        {% endif %}
                    </div>
                    <div style="line-height: 1.8;">
                        {{ task.task.content_html|safe }}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div>
                <h2 style="font-size: 1.5em; margin-bottom: 1rem;">–°–¥–∞—á–∏ —Ä–∞–±–æ—Ç—ã</h2>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% for submission in submissions %}
                    <div style="background: var(--surface-1); border: 1px solid var(--stroke-1); border-radius: var(--radius-lg); padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <div>
                                <div style="font-weight: 700; margin-bottom: 0.25rem;">{{ submission.student.name }}</div>
                                <span class="status-badge status-{{ submission.status.lower() }}" style="padding: 0.25rem 0.75rem; border-radius: var(--radius-sm); font-size: 0.85em; font-weight: 600;">
                                    {% if submission.status == 'ASSIGNED' %}–ù–∞–∑–Ω–∞—á–µ–Ω–æ
                                    {% elif submission.status == 'IN_PROGRESS' %}–í –ø—Ä–æ—Ü–µ—Å—Å–µ
                                    {% elif submission.status == 'SUBMITTED' %}–°–¥–∞–Ω–æ
                                    {% elif submission.status == 'GRADED' %}–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ
                                    {% elif submission.status == 'RETURNED' %}–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É
                                    {% else %}{{ submission.status }}{% endif %}
                                </span>
                                {% if submission.is_late %}
                                <span class="badge" style="background: var(--danger); color: white; padding: 0.25rem 0.75rem; border-radius: var(--radius-sm); font-size: 0.85em; margin-left: 0.5rem;">
                                    –û–ø–æ–∑–¥–∞–Ω–∏–µ
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        {% if submission.status == 'SUBMITTED' or submission.status == 'GRADED' %}
                        <div style="margin-top: 0.75rem;">
                            <a href="{{ url_for('assignments.submission_grade_view', submission_id=submission.submission_id) }}" class="btn-primary" style="display: block; text-align: center; padding: 0.75rem;">
                                {% if submission.status == 'SUBMITTED' %}–ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                                {% else %}–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏{% endif %}
                            </a>
                        </div>
                        {% endif %}
                        {% if submission.status == 'GRADED' and submission.total_score is not none %}
                        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--stroke-1); text-align: center;">
                            <div style="font-size: 1.2em; font-weight: 700; color: var(--accent-1);">
                                {{ submission.total_score }}/{{ submission.max_score }} ({{ "%.1f"|format(submission.percentage) }}%)
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>
    
    <style>
        .status-assigned { background: var(--surface-2); color: var(--text-primary); }
        .status-in_progress { background: var(--accent-2); color: white; }
        .status-submitted { background: var(--accent-1); color: white; }
        .status-graded { background: var(--success); color: white; }
        .status-returned { background: var(--warning); color: white; }
    </style>
</body>
</html>
