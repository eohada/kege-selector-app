# Сценарии работы пользователей

## Обзор

Документ описывает все основные сценарии использования платформы для подготовки к ЕГЭ по математике с точки зрения различных ролей пользователей.

---

## Роли пользователей

1. **Creator** - Создатель (полный доступ)
2. **Admin** - Администратор (практически полный доступ)
3. **Tutor** - Преподаватель
4. **Student** - Ученик
5. **Parent** - Родитель
6. **Tester** - Тестировщик
7. **Chief Tester** - Главный тестировщик
8. **Designer** - Дизайнер

---

## Сценарии для Преподавателя (Tutor)

### 1. Вход в систему

**Шаги:**
1. Открыть страницу входа `/auth/login`
2. Ввести логин и пароль
3. Нажать "Войти"

**Результат:**
- Редирект на `/dashboard`
- Отображение дашборда преподавателя
- Доступ к основным разделам

---

### 2. Просмотр списка учеников

**Шаги:**
1. Перейти в раздел "Ученики" (`/students`)
2. Просмотреть список всех учеников

**Доступная информация:**
- Имя ученика
- Контакты (телефон, email)
- Целевой балл
- Статус (активный/архивный)
- Количество уроков

**Действия:**
- Создать нового ученика
- Открыть профиль ученика
- Отредактировать ученика
- Архивировать ученика

---

### 3. Создание нового ученика

**Шаги:**
1. Нажать "Добавить ученика" (`/student/new`)
2. Заполнить форму:
   - Имя (обязательно)
   - Телефон
   - Email
   - Telegram
   - Целевой балл
   - Дедлайн
   - Диагностический уровень
   - Предпочтения
   - Сильные/слабые стороны
3. Нажать "Сохранить"

**Результат:**
- Создан новый ученик
- Редирект на профиль ученика
- Ученик доступен в списке

---

### 4. Просмотр профиля ученика

**Шаги:**
1. Выбрать ученика из списка (`/student/<id>`)

**Отображаемая информация:**
- Основная информация
- Контакты
- Целевой балл и дедлайн
- Диагностика
- Статистика выполнения заданий
- Список уроков
- График прогресса

**Действия:**
- Редактировать профиль
- Создать урок
- Просмотреть статистику
- Просмотреть аналитику
- Начать урок в режиме реального времени

---

### 5. Создание урока

**Вариант A: Создание урока из профиля ученика**

**Шаги:**
1. Открыть профиль ученика
2. Нажать "Создать урок" (`/student/<id>/lesson/new`)
3. Заполнить форму:
   - Дата и время урока
   - Продолжительность
   - Тип урока (обычный, диагностика, экзамен)
   - Описание (опционально)
4. Нажать "Создать"

**Результат:**
- Создан урок
- Редирект на страницу урока
- Урок отображается в расписании

**Вариант B: Создание урока из расписания**

**Шаги:**
1. Открыть расписание (`/schedule`)
2. Выбрать дату и время
3. Нажать "Создать урок"
4. Выбрать ученика
5. Заполнить форму
6. Нажать "Создать"

---

### 6. Добавление заданий в урок

**Шаги:**
1. Открыть урок (`/lesson/<id>/view`)
2. Выбрать тип заданий:
   - Домашнее задание (`/lesson/<id>/homework-tasks`)
   - Классная работа (`/lesson/<id>/classwork-tasks`)
   - Проверочная работа (`/lesson/<id>/exam-tasks`)
3. Нажать "Добавить задания"

**Вариант A: Использование генератора**

**Шаги:**
1. Открыть генератор заданий (`/kege-generator?lesson_id=<id>&assignment_type=homework`)
2. Выбрать номера заданий (1-21)
3. Опционально: выбрать темы
4. Опционально: использовать шаблон
5. Нажать "Сгенерировать"
6. Просмотреть предложенные задания
7. Нажать "Добавить в урок"

**Результат:**
- Задания добавлены в урок
- Автоматически исключены из будущих генераций для этого ученика

**Вариант B: Ручной выбор заданий**

**Шаги:**
1. В генераторе выбрать конкретные задания
2. Нажать "Добавить выбранные"

**Вариант C: Использование шаблона**

**Шаги:**
1. Выбрать существующий шаблон
2. Нажать "Применить шаблон"
3. Задания из шаблона добавлены в урок

---

### 7. Проверка домашних заданий

**Шаги:**
1. Открыть урок (`/lesson/<id>/view`)
2. Перейти в раздел "Домашние задания"
3. Просмотреть статусы заданий:
   - Не назначено
   - Назначено
   - Выполнено
   - Проверено
4. Для каждого задания:
   - Просмотреть ответ ученика
   - Проверить правильность
   - Изменить статус

**Автоматическая проверка:**

**Шаги:**
1. Нажать "Автопроверка домашних заданий"
2. Система автоматически проверит задания с известными ответами
3. Результаты отобразятся

**Результат:**
- Статусы заданий обновлены
- Правильные ответы помечены как "Проверено"
- Неправильные требуют ручной проверки

---

### 8. Проверка классной работы

**Шаги:**
1. Открыть урок
2. Перейти в "Классная работа"
3. Просмотреть ответы ученика
4. Проверить задания
5. Использовать автопроверку при необходимости

---

### 9. Проверка проверочной работы

**Шаги:**
1. Открыть урок
2. Перейти в "Проверочная работа"
3. Просмотреть ответы
4. Проверить и оценить

---

### 10. Создание и распределение работы

**Шаги:**
1. Открыть генератор заданий (`/kege-generator`)
2. Выбрать задания для работы
3. Нажать "Создать работу"
4. Заполнить форму:
   - Название работы
   - Описание
   - Выбрать учеников для распределения
5. Нажать "Распределить"

**Результат:**
- Создана работа (`Assignment`)
- Работа распределена выбранным ученикам
- Ученики видят работу в разделе "Работы"

**Альтернатива: Использование шаблона**

**Шаги:**
1. Выбрать шаблон заданий
2. Нажать "Создать работу из шаблона"
3. Выбрать учеников
4. Распределить

---

### 11. Проверка сданных работ

**Шаги:**
1. Перейти в "Работы" → "Сданные работы" (`/submissions`)
2. Выбрать работу для проверки
3. Просмотреть ответы ученика
4. Проверить каждое задание:
   - Автоматическая проверка (для заданий с ответами)
   - Ручная проверка (для развернутых ответов)
5. Выставить оценки
6. Нажать "Сохранить оценку"

**Результат:**
- Работа проверена
- Оценка сохранена
- Ученик видит результат

---

### 12. Просмотр статистики ученика

**Шаги:**
1. Открыть профиль ученика
2. Перейти в "Статистика" (`/student/<id>/statistics`)

**Отображаемая информация:**
- Общее количество выполненных заданий
- Процент правильных ответов
- Статистика по номерам заданий (1-21)
- Статистика по темам
- Прогресс по времени
- Графики выполнения

**Действия:**
- Обновить статистику вручную
- Сбросить статистику
- Экспортировать данные

---

### 13. Просмотр аналитики ученика

**Шаги:**
1. Открыть профиль ученика
2. Перейти в "Аналитика" (`/student/<id>/analytics`)

**Отображаемая информация:**
- Детальный анализ выполнения
- Выявление слабых мест
- Рекомендации по улучшению
- Сравнение с целевым баллом
- Прогноз результата

---

### 14. Управление расписанием

**Шаги:**
1. Открыть расписание (`/schedule`)
2. Просмотреть календарь с уроками
3. Создать новый урок:
   - Выбрать дату и время
   - Выбрать ученика
   - Заполнить форму
4. Редактировать урок:
   - Нажать на урок в календаре
   - Изменить данные
   - Сохранить
5. Удалить урок:
   - Нажать на урок
   - Подтвердить удаление

**Функции:**
- Проверка пересечений по времени
- Поддержка разных часовых поясов
- Фильтрация по ученикам

---

### 15. Создание шаблона заданий

**Шаги:**
1. Открыть генератор заданий
2. Выбрать набор заданий
3. Нажать "Сохранить как шаблон"
4. Ввести название шаблона
5. Сохранить

**Результат:**
- Создан шаблон
- Шаблон доступен для использования в будущем
- Можно применить к любому уроку

---

### 16. Управление шаблонами

**Шаги:**
1. Перейти в "Шаблоны" (`/templates`)
2. Просмотреть список шаблонов
3. Создать новый шаблон
4. Редактировать существующий
5. Удалить шаблон
6. Применить шаблон к уроку

---

### 17. Просмотр напоминаний

**Шаги:**
1. Перейти в "Напоминания" (`/reminders`)
2. Просмотреть список напоминаний
3. Создать новое напоминание
4. Удалить напоминание

---

## Сценарии для Ученика (Student)

### 1. Вход в систему

**Шаги:**
1. Открыть страницу входа
2. Ввести логин и пароль
3. Войти

**Результат:**
- Редирект на дашборд ученика
- Отображение назначенных работ и уроков

---

### 2. Просмотр назначенных работ

**Шаги:**
1. Открыть дашборд
2. Перейти в "Мои работы" (`/assignments`)

**Отображаемая информация:**
- Список назначенных работ
- Статус каждой работы (не начата, в процессе, сдана, проверена)
- Дедлайн (если установлен)

---

### 3. Выполнение работы

**Шаги:**
1. Выбрать работу из списка
2. Нажать "Начать выполнение"
3. Просмотреть задания
4. Ввести ответы:
   - Для заданий с кратким ответом: ввести ответ
   - Для заданий с развернутым ответом: написать решение
5. Ответы автоматически сохраняются
6. После завершения нажать "Сдать работу"

**Функции:**
- Автосохранение ответов
- Возможность вернуться к работе позже
- Просмотр заданий и прикрепленных файлов

---

### 4. Просмотр результатов работы

**Шаги:**
1. Открыть сданную работу
2. Просмотреть:
   - Свои ответы
   - Правильные ответы (для проверенных заданий)
   - Оценки
   - Комментарии преподавателя

---

### 5. Просмотр профиля

**Шаги:**
1. Открыть свой профиль (`/auth/user/profile`)

**Отображаемая информация:**
- Основная информация
- Статистика выполнения заданий
- Прогресс обучения

---

## Сценарии для Родителя (Parent)

### 1. Вход в систему

**Шаги:**
1. Открыть страницу входа
2. Ввести логин и пароль
3. Войти

**Результат:**
- Редирект на дашборд родителя
- Отображение информации о детях

---

### 2. Просмотр дашборда

**Шаги:**
1. Открыть дашборд родителя (`/parent/dashboard`)

**Отображаемая информация:**
- Список детей (если привязано несколько)
- Выбор ребенка для просмотра
- Статистика по выбранному ребенку:
  - Общий прогресс
  - Выполненные задания
  - Процент правильных ответов
- Предстоящие уроки
- Недавние уроки

---

### 3. Просмотр статистики ребенка

**Шаги:**
1. Выбрать ребенка из списка
2. Просмотреть статистику:
   - Выполненные работы
   - Результаты проверок
   - Прогресс по темам
   - Графики выполнения

---

### 4. Просмотр предстоящих уроков

**Шаги:**
1. На дашборде просмотреть раздел "Предстоящие уроки"
2. Увидеть:
   - Дата и время урока
   - Преподаватель
   - Тип урока

---

### 5. Просмотр недавних уроков

**Шаги:**
1. На дашборде просмотреть раздел "Недавние уроки"
2. Увидеть:
   - Дата урока
   - Результаты
   - Выполненные задания

---

## Сценарии для Администратора (Admin/Creator)

### 1. Управление пользователями

**Шаги:**
1. Перейти в "Админ-панель" → "Пользователи"
2. Просмотреть список пользователей
3. Создать нового пользователя
4. Редактировать пользователя:
   - Изменить роль
   - Изменить права доступа
   - Активировать/деактивировать
5. Удалить пользователя

---

### 2. Управление правами доступа

**Шаги:**
1. Перейти в "Админ-панель" → "Права доступа"
2. Выбрать роль
3. Настроить права для роли:
   - Включить/выключить права
   - Сохранить изменения

---

### 3. Просмотр журнала аудита

**Шаги:**
1. Перейти в "Админ-панель" → "Журнал аудита"
2. Просмотреть записи:
   - Действие
   - Пользователь
   - Время
   - Статус
   - Метаданные
3. Фильтровать по:
   - Пользователю
   - Действию
   - Дате
   - Статусу

---

### 4. Управление режимом обслуживания

**Шаги:**
1. Перейти в "Админ-панель" → "Режим обслуживания"
2. Включить/выключить режим
3. Настроить сообщение для пользователей
4. Сохранить

**Результат:**
- При включенном режиме доступ к системе ограничен
- Пользователи видят сообщение об обслуживании

---

### 5. Диагностика системы

**Шаги:**
1. Перейти в "Админ-панель" → "Диагностика"
2. Просмотреть:
   - Статус базы данных
   - Статистику использования
   - Ошибки системы
   - Производительность

---

## Общие сценарии

### 1. Поиск заданий

**Шаги:**
1. Открыть генератор заданий
2. Использовать поиск:
   - По номеру задания
   - По содержимому
   - По теме
3. Просмотреть результаты
4. Выбрать задание

---

### 2. Экспорт урока в Markdown

**Шаги:**
1. Открыть урок
2. Нажать "Экспорт в Markdown"
3. Скачать файл

**Результат:**
- Создан Markdown файл с содержимым урока
- Можно использовать для печати или других целей

---

### 3. Просмотр статистики по темам

**Шаги:**
1. Открыть статистику ученика
2. Перейти в раздел "По темам"
3. Просмотреть:
   - Выполненные задания по каждой теме
   - Процент правильных ответов
   - Рекомендации

---

### 4. Управление черным списком заданий

**Шаги:**
1. В генераторе выбрать задание
2. Нажать "Добавить в черный список"
3. Указать причину
4. Сохранить

**Результат:**
- Задание исключено из генерации
- Можно просмотреть черный список
- Можно удалить задание из черного списка

---

### 5. Сброс истории использования

**Шаги:**
1. В генераторе нажать "Сбросить историю"
2. Подтвердить действие

**Результат:**
- История использования очищена
- Все задания снова доступны для генерации

---

## Технические сценарии

### 1. Автоматическое обновление статусов уроков

**Процесс:**
- Система автоматически проверяет статусы уроков
- Обновляет статус с "planned" на "in_progress" при наступлении времени
- Обновляет статус на "completed" после завершения

---

### 2. Автосохранение ответов

**Процесс:**
- При вводе ответа в работу автоматически сохраняется
- Сохранение происходит через API endpoint
- Данные сохраняются в базе данных

---

### 3. Автоматическая проверка заданий

**Процесс:**
- При нажатии "Автопроверка" система:
  - Проверяет задания с известными ответами
  - Сравнивает ответ ученика с правильным
  - Обновляет статусы заданий
  - Выставляет оценки (если применимо)

---

### 4. Логирование действий

**Процесс:**
- Все действия пользователей автоматически логируются
- Записи сохраняются в таблицу AuditLog
- Включает: действие, пользователь, время, статус, метаданные

---

## Примечания

- Все действия требуют авторизации (кроме публичных API)
- Права доступа проверяются для каждого действия
- Система поддерживает несколько часовых поясов (Москва, Томск)
- Автосохранение работает для всех форм ввода
- История использования заданий отслеживается автоматически
