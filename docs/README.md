# Генератор уникальных заданий КЕГЭ

Система для автоматизированного подбора заданий с отслеживанием истории использования.

## Возможности

- ✅ Парсинг всех 27 типов заданий с сайта kompege.ru
- ✅ Автоматическое извлечение прикрепленных файлов (Excel, текстовые файлы)
- ✅ Три состояния заданий:
  - **Принято** - задание сохранено и больше не будет показываться
  - **Пропущено** - задание можно вернуть в выборку позже
  - **Черный список** - задание никогда не будет показываться
- ✅ Массовые операции с заданиями
- ✅ Работа с пропущенными заданиями
- ✅ Сброс истории использования
- ✅ Управление учениками и уроками
- ✅ Расписание занятий
- ✅ Шаблоны заданий
- ✅ Система аудита действий

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Установите браузеры для Playwright:
```bash
playwright install chromium
```

3. Инициализируйте базу данных:
```bash
flask init-db
```

## Использование

### 1. Запуск парсера

Запустите парсер для заполнения базы данных заданиями:

```bash
python scraper/playwright_parser.py
```

Парсер автоматически обработает все 27 типов заданий. Процесс может занять некоторое время.

### 2. Запуск веб-приложения

```bash
python app.py
```

Или через Flask:

```bash
flask run
```

Приложение будет доступно по адресу: http://127.0.0.1:5000

### 3. Работа с заданиями

1. **Выбор заданий:**
   - Выберите тип задания (1-27)
   - Укажите количество заданий
   - Опционально включите "Включить пропущенные задания"
   - Нажмите "Сгенерировать Набор"

2. **Действия с заданиями:**
   - **Принять** - задание сохраняется и больше не показывается
   - **Пропустить** - задание можно вернуть в выборку позже
   - **В черный список** - задание никогда не будет показываться

3. **Массовые операции:**
   - Используйте чекбоксы для выбора нескольких заданий
   - Нажмите соответствующую кнопку для массового действия

4. **Скачивание файлов:**
   - Если в задании есть прикрепленные файлы (Excel, текстовые), они отображаются в отдельном блоке
   - Нажмите на ссылку файла для скачивания

## Структура проекта

```
kege_selector_app/
├── app.py                    # Точка входа приложения
├── app_old.py               # Резервная копия старого app.py
├── app/                      # Основное приложение (Flask Blueprints)
│   ├── __init__.py          # Фабрика приложений
│   ├── models/               # Модели базы данных
│   ├── auth/                # Аутентификация
│   ├── main/                # Главная страница и dashboard
│   ├── students/            # Управление учениками
│   ├── lessons/             # Управление уроками
│   ├── admin/               # Администрирование
│   ├── kege_generator/      # Генератор заданий КЕГЭ
│   ├── api/                 # API маршруты
│   ├── schedule/            # Расписание
│   ├── templates_manager/   # Управление шаблонами
│   └── utils/               # Утилиты и хуки
├── core/                     # Ядро приложения
│   ├── db_models.py         # Модели базы данных
│   ├── selector_logic.py    # Логика выбора заданий
│   ├── audit_logger.py     # Система аудита
│   └── audit_decorators.py # Декораторы для аудита
├── scraper/                  # Парсер заданий
│   └── playwright_parser.py
├── scripts/                  # Вспомогательные скрипты
│   ├── bulk_create_lessons.py
│   ├── extract_answers.py
│   └── ...
├── templates/                # HTML шаблоны
├── static/                   # Статические файлы
│   ├── font/                # Шрифты
│   ├── icons/               # Иконки
│   ├── katex/               # KaTeX для формул
│   └── *.js, *.css          # JavaScript и CSS файлы
├── data/                     # Данные приложения
│   └── keg_tasks.db         # База данных SQLite
├── backups/                  # Резервные копии БД
├── logs/                     # Логи приложения
│   └── app.log
├── docs/                     # Документация
│   ├── README.md
│   ├── RAILWAY_SETUP.md
│   └── ...
├── requirements.txt          # Зависимости Python
└── Procfile                  # Конфигурация для Railway
```

## Архитектура

Приложение использует Flask Blueprints для модульной структуры:

- **auth** - Аутентификация пользователей
- **main** - Главная страница и dashboard
- **students** - CRUD операции с учениками
- **lessons** - Управление уроками, домашними заданиями, классной работой
- **admin** - Администрирование системы, журнал аудита
- **kege_generator** - Генератор уникальных заданий
- **api** - REST API для интеграции
- **schedule** - Расписание занятий
- **templates_manager** - Управление шаблонами заданий

## База данных

Приложение использует SQLite для локальной разработки и PostgreSQL для production.

Основные таблицы:
- `Tasks` - задания КЕГЭ
- `Student` - ученики
- `Lesson` - уроки
- `LessonTask` - связь уроков и заданий
- `UsageHistory` - история использования заданий
- `SkippedTasks` - пропущенные задания
- `BlacklistTasks` - задания в черном списке
- `User` - пользователи системы
- `AuditLog` - журнал аудита действий
- `TaskTemplate` - шаблоны заданий

## Разработка

### Добавление нового маршрута

1. Создайте или выберите подходящий blueprint в `app/`
2. Добавьте маршрут в `routes.py` соответствующего blueprint
3. Обновите шаблоны в `templates/` при необходимости

### Миграции базы данных

Миграции выполняются автоматически при первом запуске через `app/utils/db_migrations.py`.

## Деплой

Приложение готово к деплою на Railway или другие платформы. Используйте `Procfile` для настройки.

## Лицензия

Проект для внутреннего использования.
