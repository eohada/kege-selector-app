# Структура проекта

## Обзор

Проект организован по принципу модульной архитектуры с использованием Flask Blueprints.

## Директории

### `/app` - Основное приложение
Модульная структура Flask приложения с использованием Blueprints.

- **`__init__.py`** - Фабрика приложений Flask, инициализация расширений
- **`models/`** - Модели базы данных (экспорт из core.db_models)
- **`auth/`** - Аутентификация и авторизация
  - `routes.py` - Маршруты входа/выхода, профиль пользователя
- **`main/`** - Главная страница и dashboard
  - `routes.py` - Dashboard, статистика, сервинг шрифтов
- **`students/`** - Управление учениками
  - `routes.py` - CRUD операции с учениками
  - `forms.py` - Формы для работы с учениками
  - `utils.py` - Утилиты (нормализация класса)
- **`lessons/`** - Управление уроками
  - `routes.py` - CRUD уроков, домашние задания, классная работа, проверочные
  - `forms.py` - Формы для уроков
  - `utils.py` - Утилиты (сортировка заданий, автопроверка)
  - `export.py` - Экспорт в Markdown
- **`admin/`** - Администрирование
  - `routes.py` - Админ панель, журнал аудита, управление пользователями
- **`kege_generator/`** - Генератор заданий КЕГЭ
  - `routes.py` - Генерация заданий, действия с заданиями
  - `forms.py` - Формы выбора заданий, сброса истории, поиска
- **`api/`** - REST API
  - `routes.py` - API endpoints для интеграции
- **`schedule/`** - Расписание занятий
  - `routes.py` - Календарь, создание уроков из расписания
- **`templates_manager/`** - Управление шаблонами
  - `routes.py` - CRUD шаблонов, применение к урокам
- **`utils/`** - Утилиты и хуки
  - `hooks.py` - before_request, after_request хуки, context processors
  - `db_migrations.py` - Миграции базы данных

### `/core` - Ядро приложения
Базовые компоненты, используемые во всем приложении.

- **`db_models.py`** - Все модели SQLAlchemy
- **`selector_logic.py`** - Логика выбора уникальных заданий
- **`audit_logger.py`** - Система аудита действий
- **`audit_decorators.py`** - Декораторы для автоматического аудита

### `/scraper` - Парсер заданий
- **`playwright_parser.py`** - Парсинг заданий с kompege.ru

### `/scripts` - Вспомогательные скрипты
Одноразовые и утилитарные скрипты для обслуживания системы.

- `bulk_create_lessons.py` - Массовое создание уроков
- `extract_answers.py` - Извлечение ответов из заданий
- `reparse_with_preservation.py` - Перепарсинг с сохранением данных
- `restore_from_backup.py` - Восстановление из бэкапа
- И другие служебные скрипты

### `/templates` - HTML шаблоны
Jinja2 шаблоны для всех страниц приложения.

### `/static` - Статические файлы
- **`font/`** - Шрифты (OTF, TTF)
- **`icons/`** - Иконки
- **`katex/`** - Библиотека KaTeX для отображения формул
- **`*.js`** - JavaScript модули
- **`*.css`** - Стили

### `/data` - Данные приложения
- **`keg_tasks.db`** - База данных SQLite (локальная разработка)
- Резервные копии JSON

### `/backups` - Резервные копии БД
Автоматические бэкапы базы данных

### `/logs` - Логи приложения
- **`app.log`** - Основной лог приложения

### `/docs` - Документация
- **`README.md`** - Основная документация
- **`PROJECT_STRUCTURE.md`** - Этот файл
- Другие документы по настройке и использованию

## Файлы в корне

- **`app.py`** - Точка входа приложения (использует фабрику из app/__init__.py)
- **`app_old.py`** - Резервная копия старого монолитного app.py
- **`requirements.txt`** - Зависимости Python
- **`Procfile`** - Конфигурация для Railway
- **`.gitignore`** - Игнорируемые файлы Git

## Принципы организации

1. **Модульность** - Каждый функциональный блок в своем blueprint
2. **Разделение ответственности** - Routes, Forms, Utils разделены
3. **Переиспользование** - Общие компоненты в core/
4. **Чистота** - Временные файлы в scripts/, логи в logs/
5. **Документация** - Вся документация в docs/

## Миграция со старой структуры

Старый монолитный `app.py` был разделен на:
- 9 blueprints в `app/`
- Утилиты в `app/utils/`
- Модели остались в `core/db_models.py` (экспортируются через `app/models/`)

