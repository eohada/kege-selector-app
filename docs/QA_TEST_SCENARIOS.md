## QA сценарии тестирования (платформа до “тренажёра”)

Цель: дать тестировщикам понятный список сценариев “что сделать” и “что ожидать” по всем внедрённым нововведениям.

---

### 0) Общие правила и подготовка

#### 0.1 Роли для теста
- **creator**: полный доступ ко всему, включая “удалённую админку”.
- **admin**: полный доступ к платформе по RBAC (если права включены).
- **tutor**: управляет уроками/проверкой/расписанием в рамках своих учеников.
- **student**: видит только себя и свои данные.
- **parent**: видит только своих детей и их данные.
- (опц.) **designer**, **tester**, **chief_tester**: проверка ограниченных прав (если используются).

#### 0.2 Рекомендуемый тестовый набор данных
Создать (или проверить существование) минимум:
- **2 преподавателя**: `tutorA`, `tutorB`
- **3 ученика**: `student1`, `student2` (у `tutorA`), `student3` (у `tutorB`)
- **1 родитель**: `parent1`, привязать к `student1` и `student2`
- **1 админ** и **1 creator**
- Для каждого ученика: минимум **2 урока** (один “planned”, один “completed”), с разными датами.

#### 0.3 Что фиксировать при тестировании
- Скриншот/видео при баге
- Роль пользователя, URL страницы, время/таймзона
- Ожидаемое поведение vs фактическое
- Если API/ошибка: статус код + текст

---

### 1) Навигация и UI-консистентность (общий smoke)

#### 1.1 Верхнее меню (каждая роль)
**Шаги:**
1) Войти под ролью.
2) Проверить верхнее меню и выпадающие пункты.

**Ожидаемое:**
- Нет перегруза кнопками: основные разделы сверху, остальное сгруппировано в dropdown.
- Пункты меню видны **только по правам** (RBAC).
- Активный раздел подсвечивается корректно (в т.ч. биллинг/расписание).

#### 1.2 Базовые страницы доступны/недоступны по ролям
**Шаги:** зайти по прямым URL в “чужие” разделы (например, учеником открыть admin/billing/создание урока).
**Ожидаемое:** 403/редирект с понятным сообщением “нет прав”.

---

### 2) Расписание (Schedule)

#### 2.1 Просмотр расписания (student)
**Шаги:**
1) Войти как `student1`.
2) Открыть “Расписание”.

**Ожидаемое:**
- Видны **только уроки этого ученика**.
- Нет кнопок/действий управления (создание/перетаскивание/удаление).
- Инспектор урока открывается в read-only.

#### 2.2 Просмотр расписания (parent)
**Шаги:**
1) Войти как `parent1`.
2) Открыть “Расписание”.
3) Переключить фильтр ученика (если доступен).

**Ожидаемое:**
- Видны уроки **только детей** (`student1`, `student2`).
- Нет управления расписанием.

#### 2.3 Управление расписанием (tutor)
**Шаги:**
1) Войти как `tutorA`.
2) Открыть “Расписание”.
3) Создать урок кликом по сетке.
4) Перенести урок drag&drop.
5) Изменить статус урока через инспектор.

**Ожидаемое:**
- Можно создавать/переносить/редактировать **в пределах своих учеников**.
- При переносе дата/время меняются корректно.
- Статусы применяются и отражаются в UI.

#### 2.4 Проверка пересечений (tutor overlap)
**Шаги:**
1) Войти как `tutorA`.
2) Попробовать создать/перенести урок так, чтобы он пересёкся по времени с другим уроком `tutorA`.

**Ожидаемое:**
- Операция отклоняется с понятным сообщением о конфликте (не создаёт “двойную бронь”).

#### 2.5 Виды “Неделя / Список”
**Шаги:** переключить “Неделя” и “Список”.
**Ожидаемое:** данные те же, меняется только представление; ссылки “Открыть урок/Профиль” корректны.

#### 2.6 Экспорт .ics и токен синхронизации
**Шаги:**
1) Зайти в профиль пользователя, найти блок синхронизации календаря.
2) Сгенерировать/обновить ссылку.
3) Открыть ссылку .ics в браузере (в новой вкладке/инкогнито).

**Ожидаемое:**
- Ссылка генерируется, меняется при обновлении.
- По ссылке отдаётся календарь с уроками в рамках прав пользователя.
- Старая ссылка после обновления становится невалидной (или перестаёт соответствовать новому токену).

#### 2.7 Автоплан (Recurring slots)
**Шаги (tutor):**
1) Открыть “Автоплан”.
2) Создать слот (ученик, день недели, время, длительность).
3) Нажать “Сгенерировать неделю”.
4) Повторить генерацию второй раз.

**Ожидаемое:**
- Уроки создаются на неделю по слотам.
- Повторная генерация не создаёт дублей/пересечений (или корректно пропускает конфликтующие).

---

### 3) Уроки и защищённые материалы (Uploads / Files)

#### 3.1 Загрузка материалов в урок
**Шаги (tutor):**
1) Открыть урок ученика.
2) Загрузить файл (png/pdf/docx и т.д. в разрешённых расширениях).
3) Убедиться, что файл появляется в списке материалов.

**Ожидаемое:**
- Файл добавлен и открывается по защищённой ссылке (`/files/...`).
- Нельзя скачать файл без прав (проверить инкогнито/под другим пользователем).

#### 3.2 Доступ к материалам по ролям
**Шаги:**
1) Создать материал в уроке `student1`.
2) Открыть ссылку на файл:
   - как `student1` (должно открываться)
   - как `parent1` (должно открываться)
   - как `student3` (должно быть запрещено)

**Ожидаемое:** доступ только в рамках data-scope.

---

### 4) Единый журнал проверок (Review queue)

#### 4.1 Просмотр очереди (tutor)
**Шаги:**
1) Войти как `tutorA`.
2) Открыть “Проверка”.
3) Поиграть фильтрами: статус/источник/тип/поиск ученика.

**Ожидаемое:**
- Карточки показывают корректное количество задач/сдач.
- Фильтры не ломают список и работают предсказуемо.

#### 4.2 Массовые действия
**Шаги:**
1) В режиме “submitted” выполнить действие “Всё проверено” или “На доработку”.
2) Для работ — “Проверено всем / Вернуть всем”.

**Ожидаемое:**
- Статусы обновляются корректно.
- Действия доступны только при уместном статусе.
- Кнопки сгруппированы (“Ещё”), интерфейс не перегружен.

---

### 5) Рубрики (критерии проверки)

#### 5.1 CRUD рубрик (tutor)
**Шаги:**
1) Открыть “Рубрики”.
2) Создать новую рубрику, добавить несколько критериев с max_score.
3) Отредактировать рубрику.
4) Удалить рубрику.

**Ожидаемое:**
- Создание/редактирование сохраняется.
- Удаление не ломает интерфейс (рубрика исчезает из списка).
- Доступ к разделу только по праву `rubrics.manage`.

#### 5.2 Применение рубрики при проверке
**Шаги (tutor):**
1) Открыть страницу проверки сдачи.
2) Выбрать рубрику, выставить баллы/комментарии.
3) Сохранить.

**Ожидаемое:**
- Значения сохраняются, после перезагрузки не пропадают.
- Есть базовая валидация (не даёт заведомо некорректные значения).

---

### 6) Диагностика ученика

#### 6.1 Просмотр диагностики
**Шаги:**
1) Открыть “Диагностика” ученика из профиля.
2) Проверить блок “Слабые темы” и “Рекомендации”.

**Ожидаемое:**
- Доступ только по правам и scope.
- Данные отображаются корректно; если данных нет — показывается пустое состояние.

#### 6.2 Контрольные точки (checkpoint/baseline)
**Шаги (tutor/admin):**
1) Нажать “Сохранить контрольную точку”.
2) Ввести заметку, выбрать тип.
3) Проверить, что запись появилась в истории.

**Ожидаемое:**
- Запись создана и отображается в списке.
- Ученик/родитель не видят кнопку сохранения.

---

### 7) Дашборды ролей

#### 7.1 Дашборд преподавателя
**Шаги:** открыть дашборд и проверить блок “Сегодня”.
**Ожидаемое:** счётчики и ссылки ведут в корректные разделы.

#### 7.2 Дашборд ученика
**Шаги:** зайти учеником, проверить “траектория”, “активные работы”, “слабые темы”, “последние оценки”.
**Ожидаемое:** данные в рамках ученика, без утечек.

#### 7.3 Дашборд родителя
**Шаги:** зайти родителем, переключить ребёнка, проверить метрики/списки.
**Ожидаемое:** видны только дети, данные корректны.

---

### 8) Отчёты и экспорт (PDF)

#### 8.1 Экспорт журнала ученика в PDF
**Шаги:** открыть журнал ученика → нажать “Экспорт PDF”.
**Ожидаемое:** скачивается PDF (или fallback HTML, если PDF-движок недоступен), формат читаемый.

#### 8.2 Экспорт группы в PDF
**Шаги:** открыть группу → “Экспорт PDF”.
**Ожидаемое:** файл скачивается, состав группы корректный.

---

### 9) Биллинг (MVP)

#### 9.1 Тарифы
**Шаги (роль с `billing.manage`):**
1) Открыть “Тарифы/подписки”.
2) Создать тариф.
3) Включить/выключить тариф.

**Ожидаемое:** всё сохраняется, список обновляется.

#### 9.2 Подписки
**Шаги (роль с `billing.manage`):**
1) Открыть “Подписки”.
2) Создать подписку пользователю.
3) Отменить подписку.

**Ожидаемое:** статусы меняются корректно.

---

### 10) Юридический слой

#### 10.1 Оферта/политика
**Шаги:** открыть страницы оферты/политики, нажать “принять”.
**Ожидаемое:** согласие фиксируется (без ошибок), повторное принятие не ломает.

---

### 11) RBAC и удалённая админка

#### 11.1 Remote admin: отображение новых прав
**Шаги (creator):**
1) Открыть удалённую админку → “Права доступа”.
2) Выбрать роли и проверить наличие новых прав (schedule, billing, diagnostics, rubrics, trainer и т.п.).

**Ожидаемое:** новые пункты есть, чекбоксы сохраняются.

#### 11.2 Remote admin: выключить право и проверить факт
**Шаги:**
1) Выключить, например, `billing.manage` у `admin`.
2) Зайти на платформе под `admin` и попробовать открыть биллинг.

**Ожидаемое:** доступ реально пропадает (403), меню скрывает пункт.

---

### 12) Негативные/безопасностные сценарии (обязательно)

#### 12.1 Попытка открыть чужие данные прямым URL
**Шаги:** учеником открыть:
- чужой профиль ученика
- чужой файл урока
- чужой урок/оценки

**Ожидаемое:** 403/редирект, нет утечки данных.

#### 12.2 Проверка работы без данных
**Шаги:** открыть страницы (расписание/диагностика/очередь) для “пустого” ученика.
**Ожидаемое:** корректные пустые состояния, нет ошибок 500.

